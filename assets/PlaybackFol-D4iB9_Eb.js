import{u as me}from"./theme-CKAttjlI.js";import{_ as Me}from"./MainWrapperView.vue_vue_type_style_index_0_lang-BJ0qikSj.js";import{_ as K}from"./SelectView.vue_vue_type_style_index_0_lang-zJHKqYe8.js";import{_ as te}from"./InputView.vue_vue_type_style_index_0_lang-1hC75LMg.js";import{_ as U}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-DfbZXUMX.js";import{t as ye}from"./trunk-CuaAdnZJ.js";import{a as Ce}from"./axios-BimPEqV4.js";import{d as be,e as l,l as h,r as se,o as v,c as g,g as t,a,w as c,q as D,m as F,n as q,u as b,y as Z,D as ee,f as le,t as L,h as ce,F as ie,_ as Se,j as $e,z as fe,p as Fe}from"./index-BzVVXQ9R.js";import{i as Ye}from"./index-CehbAW_K.js";import{h as A}from"./moment-C5S46NFB.js";const _e={key:0,class:"datepickdialog"},Pe={class:"datepickinner"},Ve={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Te={key:1,class:"selfnavdialog"},Re={class:"selfnavdialog-inner"},Ae={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ue={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},ze={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Le={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Ne={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Ie={key:1,style:{"font-size":"11px"}},Be={style:{position:"relative"}},Oe={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center"}},je={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},qe={style:{width:"100%",padding:"10px",position:"relative"}},Ee=["max","value"],Ge={class:"slider-highlight"},He={key:0,class:"hmloader"},We=be({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0},isWaiting:{type:Boolean}},emits:["onDateChange"],setup(ue,{emit:ae}){const J=ye(),M=ae,f=me(),i=ue,N=l(),x=l(),z=l(J.getAllTrunk()),r=l(0),O=l(0),G=l([]),E=l(!1),I=l(500);let C=null;const w=l(!1),j=l(!1),Y=l("forward");let H=[];const p={},u=l(),m=l(""),n=l(""),d=l(!0),S=l(!1),s=l(!1),_=l(!1),re=()=>{x.value=Ye(N.value);const k={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};x.value.setOption(k)};h(()=>N.value,()=>{re(),Q(r.value)}),h(()=>i.initPlaybackData,()=>{$(),re(),E.value=!1,S.value&&(s.value=!0)});const Q=k=>{H=[];for(let R of z.value[i.selectedSpot].spot)p[R.name]=[];i.initPlaybackData.slice(0,k+1).forEach((R,o)=>{const ve=`${R.dateFilter} (${R.timeRange})`;H.push(ve),u.value=ve,R.data.forEach(pe=>{const De=z.value[i.selectedSpot].spot.find(he=>he.id===pe.idSpot).name,we=pe.avgPsiValues??0;p[De][o]=Number(we.toFixed(2))})});const y=Object.keys(p).map(R=>({name:R,type:"line",data:p[R],symbol:"none",smooth:!0,tooltip:{trigger:"axis",formatter:function(o){return o[0].value}},endLabel:{show:!0,formatter:function(o){return o.value},color:"#000",backgroundColor:"inherit",padding:5,borderRadius:5}}));x.value.setOption({xAxis:{data:H},series:y})},$=()=>{s.value=!1,r.value=0,G.value=[],clearInterval(C),Q(r.value),O.value=r.value/i.initPlaybackData.length*100},ge=k=>{s.value=!1,G.value=[],r.value=parseInt(k.target.value,10),Q(r.value),O.value=r.value/i.initPlaybackData.length*100};h(()=>i.initDateFilter,()=>{de()});const de=()=>{const k=A(i.initDateFilter),e=k.add(1,"days").format("YYYY-MM-DD"),y=k.subtract(2,"days").format("YYYY-MM-DD");m.value=e,n.value=y};de();const oe=()=>{_.value=!0,$();const k=A(m.value).format("YYYY-MM-DD");S.value&&(s.value=!0),E.value=!0,M("onDateChange",k),setTimeout(()=>{_.value=!1},5e3)},ne=()=>{_.value=!0,$();const k=A(n.value).format("YYYY-MM-DD");S.value&&(s.value=!0),E.value=!0,M("onDateChange",k),setTimeout(()=>{_.value=!1},5e3)};h(()=>d.value,()=>{d.value&&(W(),w.value=!1,S.value=!1)}),h(()=>w.value,()=>{w.value?d.value=!1:d.value=!0}),h(()=>s.value,()=>{!s.value&&r.value==i.initPlaybackData.length&&(d.value?($(),s.value=!0):($(),s.value=!0,w.value&&(Y.value=="forward"?P.value?(console.log(i.initDateFilter,V.value),i.initDateFilter!=T.value?oe():X.value?($(),M("onDateChange",V.value)):W()):oe():P.value?i.initDateFilter!=V.value?ne():X.value?($(),M("onDateChange",T.value)):W():ne())))}),h(()=>[s.value,I.value],()=>{s.value?(C!=null&&clearInterval(C),C=setInterval(()=>{r.value<i.initPlaybackData.length?(r.value++,i.initPlaybackData[r.value]!=null&&(Q(r.value),O.value=r.value/i.initPlaybackData.length*100)):(s.value=!1,clearInterval(C))},I.value)):C&&(clearInterval(C),C=null)}),h(()=>[f.asideVisible],()=>{setTimeout(()=>{x.value.resize()},1e3)});const xe=()=>Y.value=="forward"?m.value:n.value,B=l(!1),P=l(!1),X=l(!0),V=l(""),T=l(""),ke=()=>{V.value?T.value?(P.value=!0,d.value=!1,w.value=!0,S.value=!0,B.value=!1,s.value=!1):f.notifyShowError("Date 2 is required"):f.notifyShowError("Date 1 is required")};h(()=>B.value,()=>{B.value?(s.value=!1,P.value=!1):s.value=!0}),h(()=>[P.value],()=>{P.value&&($(),Y.value=="forward"?M("onDateChange",V.value):M("onDateChange",T.value))}),h(()=>Y.value,()=>{Y.value=="backward"&&($(),W())});const W=()=>{$(),console.log(i.initDateFilter),M("onDateChange",i.initDateFilter),P.value=!1,V.value=null,T.value=null};return(k,e)=>{const y=se("font-awesome-icon"),R=se("center");return v(),g(ie,null,[B.value?(v(),g("div",_e,[t("div",Pe,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),a(K,{"in-label":"Speed","model-value":I.value,"onUpdate:modelValue":e[0]||(e[0]=o=>I.value=o)},{default:c(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),a(te,{"in-type":"date","in-label":"Date 1","model-value":V.value,"onUpdate:modelValue":e[1]||(e[1]=o=>V.value=o)},null,8,["model-value"]),a(te,{"in-type":"date","in-label":"Date 2","model-value":T.value,"onUpdate:modelValue":e[2]||(e[2]=o=>T.value=o)},null,8,["model-value"]),t("div",Ve,[a(U,{onClick:ke,"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[16]||(e[16]=[D("Apply Filter")])),_:1}),a(U,{onClick:e[3]||(e[3]=o=>B.value=!B.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[17]||(e[17]=[D("Cancel")])),_:1})])])])):F("",!0),j.value?(v(),g("div",Te,[t("div",Re,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),a(K,{"in-label":"Direction","model-value":Y.value,"onUpdate:modelValue":e[4]||(e[4]=o=>Y.value=o)},{default:c(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),a(U,{onClick:e[5]||(e[5]=o=>j.value=!j.value),style:{width:"fit-content"},"bt-disabled":!1},{default:c(()=>[a(y,{icon:"save"}),e[21]||(e[21]=D(" Apply"))]),_:1})])])):F("",!0),e[32]||(e[32]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),a(R,null,{default:c(()=>[a(K,{style:{width:"400px"},"in-label":"Speed","model-value":I.value,"onUpdate:modelValue":e[6]||(e[6]=o=>I.value=o)},{default:c(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Ae,[t("div",Ue,[t("label",{class:q([`${b(f).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[Z(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>d.value=o),type:"checkbox"},null,512),[[ee,d.value]]),e[24]||(e[24]=D(" Auto-replay "))],2),t("label",{class:q([`${b(f).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[Z(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>S.value=o),type:"checkbox"},null,512),[[ee,S.value]]),e[25]||(e[25]=D(" Autoplay on navigating "))],2),t("label",{class:q([`${b(f).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[Z(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>w.value=o),type:"checkbox"},null,512),[[ee,w.value]]),e[26]||(e[26]=D(" Self Navigate "))],2),w.value?(v(),le(U,{key:0,onClick:e[10]||(e[10]=o=>j.value=!j.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[a(y,{icon:"sliders"})]),_:1})):F("",!0)]),t("div",ze,[P.value?(v(),g("label",{key:0,class:q([`${b(f).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[D(L(b(A)(V.value).format("ddd, DD MMM YY"))+"    ",1),a(y,{icon:Y.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),D("    "+L(b(A)(T.value).format("ddd, DD MMM YY")),1)],2)):F("",!0),P.value?(v(),g("label",{key:1,class:q([`${b(f).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[Z(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>X.value=o),type:"checkbox"},null,512),[[ee,X.value]]),e[27]||(e[27]=D(" Repeat "))],2)):F("",!0),a(U,{onClick:e[12]||(e[12]=o=>B.value=!B.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[a(y,{icon:"calendar"})]),_:1}),V.value&&T.value?(v(),le(U,{key:2,onClick:W,"bt-disabled":!1,class:"slfnavbtn"},{default:c(()=>[a(y,{icon:"close"})]),_:1})):F("",!0)])]),t("div",Le,[a(U,{"bt-disabled":_.value,onClick:ne},{default:c(()=>[a(y,{icon:"backward"}),D("    "+L(b(A)(n.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Ne,[t("b",{style:ce({color:`${b(f).accentColor}`})},L(b(A)(i.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),P.value?(v(),g("span",{key:0,class:q([`${b(f).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=D("Stops at: ")),t("b",null,L(b(A)(T.value).format("ddd, DD MMM YY")),1)],2)):(v(),g("span",Ie,[e[29]||(e[29]=D("Upcoming: ")),t("b",null,L(b(A)(xe()).format("ddd, DD MMM YY")),1)]))]),a(U,{"bt-disabled":_.value,onClick:oe},{default:c(()=>[D(L(b(A)(m.value).format("ddd, DD MMM YY"))+"    ",1),a(y,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Be,[t("div",{ref_key:"heatMap",ref:N,style:{width:"100%",height:"600px"}},null,512),t("div",Oe,[t("div",je,[s.value?F("",!0):(v(),g("button",{key:0,onClick:e[13]||(e[13]=o=>s.value=!s.value),class:"controlbtn",type:"button"},[a(y,{icon:"play"})])),s.value?(v(),g("button",{key:1,onClick:e[14]||(e[14]=o=>s.value=!s.value),class:"controlbtn",type:"button"},[a(y,{icon:"pause"})])):F("",!0)]),t("div",qe,[t("input",{onChange:ge,type:"range",min:0,max:i.initPlaybackData.length,value:r.value,class:"slider"},null,40,Ee),t("span",Ge,[t("span",{class:"slider-track",style:ce({width:`${O.value}%`})},null,4)])]),t("div",null,[!s.value&&r.value==i.initPlaybackData.length?(v(),g("button",{key:0,onClick:$,class:"controlbtn",type:"button"},[a(y,{icon:"undo"})])):F("",!0)])]),E.value?(v(),g("div",He,e[31]||(e[31]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif"},null,-1)]))):F("",!0)])],64)}}}),Ke=Se(We,[["__scopeId","data-v-fba285a6"]]),Je={class:"row"},Qe={class:"col-md-3"},Xe=["value"],Ze={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},et={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},tt={class:"col-md-12"},pt=be({__name:"PlaybackFol",setup(ue){const ae=ye(),J=me();J.asideToggle(!1);const M=l(ae.getAllTrunk()),f=l("trunk1"),i=l();i.value=Object.keys(M.value);const N=l(5),x=l(),z=l([]),r=l(0),O=l([]),G=l(!1),E=()=>{r.value++,z.value.push(null)};$e(()=>{I(),setTimeout(()=>{G.value=!0},1e3)}),h(()=>[x.value,N.value,f.value],async()=>{await w()});const I=()=>{const p=new Date,u=p.getFullYear(),m=String(p.getMonth()+1).padStart(2,"0"),n=String(p.getDate()).padStart(2,"0"),d=`${u}-${m}-${n}`;x.value=d},C=async p=>new Promise(async(u,m)=>{try{const n=M.value[f.value];let d=[];for(let _=0;_<n.spot.length;_++)d.push(n.spot[_].id);const S={datefilter:p,timeFilter:N.value,idFilter:d},s=await Ce.post(Fe.baseEnd+"api/History/getsplittedhistdata",S);u(s.data)}catch(n){m(n)}}),w=async()=>{try{let u=[...await C(x.value)];if(z.value.length>0)for(let m=0;m<z.value.length;m++){const n=z.value[m];if(n!==null){if(n.value!==x.value){const d=await C(n.value);u=u.concat(d)}}else console.log("Null")}O.value=u}catch(p){console.log(p)}},j=(p,u)=>{z.value[u]=p,w()},Y=()=>{r.value>0&&(r.value--,z.value.pop()),w()},H=p=>{x.value=p};return(p,u)=>{const m=se("font-awesome-icon");return v(),le(Me,{"context-title":"Data Playback"},{default:c(()=>[t("div",Je,[t("div",Qe,[u[4]||(u[4]=t("h4",null,[t("b",null,"Filter")],-1)),a(K,{"in-label":"Select Line","model-value":f.value,"onUpdate:modelValue":u[0]||(u[0]=n=>f.value=n)},{default:c(()=>[(v(!0),g(ie,null,fe(i.value,(n,d)=>(v(),g("option",{key:d,value:n},L(M.value[n].name),9,Xe))),128))]),_:1},8,["model-value"]),a(K,{"in-label":"Time Range","model-value":N.value,"onUpdate:modelValue":u[1]||(u[1]=n=>N.value=n)},{default:c(()=>u[3]||(u[3]=[t("option",{value:"1"},"1 Menit",-1),t("option",{value:"2"},"2 Menit",-1),t("option",{value:"3"},"3 Menit",-1),t("option",{value:"4"},"4 Menit",-1),t("option",{value:"5"},"5 Menit",-1),t("option",{value:"10"},"10 Menit",-1),t("option",{value:"15"},"15 Menit",-1),t("option",{value:"30"},"30 Menit",-1),t("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),t("div",Ze,[a(te,{"in-type":"date","in-label":"Date Filter","model-value":x.value,"onUpdate:modelValue":u[2]||(u[2]=n=>x.value=n),style:{width:"100%"}},null,8,["model-value"])]),t("div",et,[a(U,{onClick:Y,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[a(m,{icon:"minus"})]),_:1}),t("span",{class:q([`${b(J).textTheme}`])},L(r.value),3),a(U,{onClick:E,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[a(m,{icon:"plus"})]),_:1})]),(v(!0),g(ie,null,fe(r.value,(n,d)=>(v(),g("div",{key:d,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[a(te,{"in-type":"date","in-label":`Date Filter ${n}`,onOnValueChange:S=>j(S,d),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",tt,[G.value?(v(),le(Ke,{key:0,"init-date-filter":x.value,"selected-spot":f.value,"init-playback-data":O.value,onOnDateChange:H},null,8,["init-date-filter","selected-spot","init-playback-data"])):F("",!0)])])]),_:1})}}});export{pt as default};
