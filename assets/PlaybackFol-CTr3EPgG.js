import{u as be}from"./theme-651fL0of.js";import{_ as $e}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DhK24cef.js";import{_ as J}from"./SelectView.vue_vue_type_style_index_0_lang-u8dh47m0.js";import{_ as oe}from"./InputView.vue_vue_type_style_index_0_lang-DVGC4Udb.js";import{_ as z}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-DSozRY-2.js";import{t as ge}from"./trunk-CuaAdnZJ.js";import{a as Ye}from"./axios-BimPEqV4.js";import{d as xe,e as a,k as me,j as ke,l as D,r as ue,o as r,c as x,g as t,a as n,w as m,q as k,m as M,n as E,u as g,y as le,D as ae,f as ne,t as I,h as _e,H as Pe,F as re,_ as we,z as ye,p as Ve}from"./index-DKIE6vu9.js";import{i as Te}from"./index-CehbAW_K.js";import{h as R}from"./moment-C5S46NFB.js";const Re={key:0,class:"datepickdialog"},ze={class:"datepickinner"},Ae={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ie={key:1,class:"selfnavdialog"},Ue={class:"selfnavdialog-inner"},Le={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ne={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Oe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},je={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Be={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Ee={key:1,style:{"font-size":"11px"}},qe={style:{position:"relative"}},Ke={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Ge={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},He={style:{width:"100%",padding:"10px",position:"relative"}},We=["max","value"],Je=xe({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange","onAutoRepChanged","onAutoplayChanged","onSelfNavChanged","onDirectionChanged"],setup(de,{emit:se}){const Q=ge(),h=se,y=be(),i=de,U=a(),d=a(),A=a(Q.getAllTrunk()),u=a(0),q=a(0),O=a([]),S=a(250);let w=null;const F=a(!1),$=a("forward");let Y=null,j=[],K={};const ie=a(),G=a(""),v=a(""),o=a(!0),p=a(!1),l=a(!1),f=a(!1),B=a(!1),X=()=>{d.value=Te(U.value);const c={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};d.value.setOption(c)};Y=setInterval(()=>{d.value&&d.value&&d.value.resize()},1e3),me(()=>{clearInterval(Y)}),ke(()=>{window.addEventListener("keyup",pe),Y||(Y=setInterval(()=>{d.value&&d.value.resize()},1e3))}),me(()=>{Y&&(clearInterval(Y),Y=null)}),D(()=>U.value,()=>{X(),L(u.value)}),D(()=>i.initPlaybackData,()=>{C(),X(),B.value=!1,p.value&&(l.value=!0)});const L=c=>{j=[];for(let T of A.value[i.selectedSpot].spot)K[T.name]=[];i.initPlaybackData.slice(0,c+1).forEach((T,s)=>{const fe=`${T.dateFilter} (${T.timeRange})`;j.push(fe),ie.value=fe,T.data.forEach(ce=>{const Me=A.value[i.selectedSpot].spot.find(Fe=>Fe.id===ce.idSpot).name,Se=ce.avgPsiValues??0;K[Me][s]=Number(Se.toFixed(2))})});const b=Object.keys(K).map(T=>({name:T,type:"line",data:K[T],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(s){return s[0].value}},endLabel:{show:!0,formatter:function(s){return s.value},color:"#000",backgroundColor:"inherit",padding:5,borderRadius:5}}));d.value.setOption({xAxis:{data:j},series:b})},C=()=>{l.value=!1,u.value=0,O.value=[],clearInterval(w),L(u.value),q.value=u.value/i.initPlaybackData.length*100},De=c=>{l.value=!1,O.value=[],u.value=parseInt(c.target.value,10),L(u.value),q.value=u.value/i.initPlaybackData.length*100};D(()=>i.initDateFilter,()=>{ve()});const ve=()=>{const c=R(i.initDateFilter),e=c.add(1,"days").format("YYYY-MM-DD"),b=c.subtract(2,"days").format("YYYY-MM-DD");G.value=e,v.value=b};ve();const Z=()=>{f.value=!0,C();const c=R(G.value).format("YYYY-MM-DD");p.value&&(l.value=!0),B.value=!0,h("onDateChange",c),setTimeout(()=>{f.value=!1},5e3)},ee=()=>{f.value=!0,C();const c=R(v.value).format("YYYY-MM-DD");p.value&&(l.value=!0),B.value=!0,h("onDateChange",c),setTimeout(()=>{f.value=!1},5e3)};D(()=>o.value,()=>{o.value&&(W(),F.value=!1,p.value=!1)}),D(()=>F.value,()=>{F.value?o.value=!1:o.value=!0}),D(()=>l.value,()=>{!l.value&&u.value==i.initPlaybackData.length&&(o.value?(C(),l.value=!0):F.value?$.value=="forward"?_.value?(console.log(i.initDateFilter,P.value),i.initDateFilter!=V.value?Z():te.value?(C(),h("onDateChange",P.value)):W()):Z():_.value?i.initDateFilter!=P.value?ee():te.value?(C(),h("onDateChange",V.value)):W():ee():(C(),l.value=!1))}),D(()=>[l.value,S.value],()=>{l.value?(w!=null&&clearInterval(w),w=setInterval(()=>{u.value<i.initPlaybackData.length?(u.value++,i.initPlaybackData[u.value]!=null&&(L(u.value),q.value=u.value/i.initPlaybackData.length*100)):(l.value=!1,clearInterval(w))},S.value)):w&&(clearInterval(w),w=null)}),D(()=>[y.asideVisible],()=>{setTimeout(()=>{d.value.resize()},1e3)});const H=a(!1),he=()=>$.value=="forward"?G.value:v.value,N=a(!1),_=a(!1),te=a(!0),P=a(""),V=a(""),Ce=()=>{P.value?V.value?(_.value=!0,o.value=!1,F.value=!0,p.value=!0,N.value=!1,l.value=!1):y.notifyShowError("Date 2 is required"):y.notifyShowError("Date 1 is required")};D(()=>N.value,()=>{N.value?(l.value=!1,_.value=!1):l.value=!0}),D(()=>[_.value],()=>{_.value&&(C(),$.value=="forward"?h("onDateChange",P.value):h("onDateChange",V.value))}),D(()=>$.value,()=>{$.value=="backward"&&(C(),W())});const W=()=>{C(),console.log(i.initDateFilter),h("onDateChange",i.initDateFilter),_.value=!1,P.value=null,V.value=null},pe=c=>{(c.keyCode==80||c.keyCode==32)&&(l.value=!l.value),c.keyCode==37&&ee(),c.keyCode==39&&Z()};return(c,e)=>{const b=ue("font-awesome-icon"),T=ue("center");return r(),x(re,null,[N.value?(r(),x("div",Re,[t("div",ze,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),n(J,{"in-label":"Speed","model-value":S.value,"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s)},{default:m(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),n(oe,{"in-type":"date","in-label":"Date 1","model-value":P.value,"onUpdate:modelValue":e[1]||(e[1]=s=>P.value=s)},null,8,["model-value"]),n(oe,{"in-type":"date","in-label":"Date 2","model-value":V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s)},null,8,["model-value"]),t("div",Ae,[n(z,{onClick:Ce,"bt-disabled":!1,style:{width:"fit-content"}},{default:m(()=>e[16]||(e[16]=[k("Apply Filter")])),_:1}),n(z,{onClick:e[3]||(e[3]=s=>N.value=!N.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:m(()=>e[17]||(e[17]=[k("Cancel")])),_:1})])])])):M("",!0),H.value?(r(),x("div",Ie,[t("div",Ue,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),n(J,{"in-label":"Direction","model-value":$.value,"onUpdate:modelValue":e[4]||(e[4]=s=>$.value=s)},{default:m(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),n(z,{onClick:e[5]||(e[5]=s=>H.value=!H.value),style:{width:"fit-content"},"bt-disabled":!1},{default:m(()=>[n(b,{icon:"save"}),e[21]||(e[21]=k(" Apply"))]),_:1})])])):M("",!0),e[31]||(e[31]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),n(T,null,{default:m(()=>[n(J,{style:{width:"400px"},"in-label":"Speed","model-value":S.value,"onUpdate:modelValue":e[6]||(e[6]=s=>S.value=s)},{default:m(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Le,[t("div",Ne,[t("label",{class:E([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.value=s),type:"checkbox"},null,512),[[ae,o.value]]),e[24]||(e[24]=k(" Auto-replay "))],2),t("label",{class:E([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>p.value=s),type:"checkbox"},null,512),[[ae,p.value]]),e[25]||(e[25]=k(" Autoplay on navigating "))],2),t("label",{class:E([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>F.value=s),type:"checkbox"},null,512),[[ae,F.value]]),e[26]||(e[26]=k(" Self Navigate "))],2),F.value?(r(),ne(z,{key:0,onClick:e[10]||(e[10]=s=>H.value=!H.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:m(()=>[n(b,{icon:"sliders"})]),_:1})):M("",!0)]),t("div",Oe,[_.value?(r(),x("label",{key:0,class:E([`${g(y).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[k(I(g(R)(P.value).format("ddd, DD MMM YY"))+"    ",1),n(b,{icon:$.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),k("    "+I(g(R)(V.value).format("ddd, DD MMM YY")),1)],2)):M("",!0),_.value?(r(),x("label",{key:1,class:E([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>te.value=s),type:"checkbox"},null,512),[[ae,te.value]]),e[27]||(e[27]=k(" Repeat "))],2)):M("",!0),n(z,{onClick:e[12]||(e[12]=s=>N.value=!N.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:m(()=>[n(b,{icon:"calendar"})]),_:1}),P.value&&V.value?(r(),ne(z,{key:2,onClick:W,"bt-disabled":!1,class:"slfnavbtn"},{default:m(()=>[n(b,{icon:"close"})]),_:1})):M("",!0)])]),t("div",je,[n(z,{"bt-disabled":f.value,onClick:ee},{default:m(()=>[n(b,{icon:"backward"}),k("    "+I(g(R)(v.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Be,[t("b",{style:_e({color:`${g(y).accentColor}`})},I(g(R)(i.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),_.value?(r(),x("span",{key:0,class:E([`${g(y).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=k("Stops at: ")),t("b",null,I(g(R)(V.value).format("ddd, DD MMM YY")),1)],2)):(r(),x("span",Ee,[e[29]||(e[29]=k("Upcoming: ")),t("b",null,I(g(R)(he()).format("ddd, DD MMM YY")),1)]))]),n(z,{"bt-disabled":f.value,onClick:Z},{default:m(()=>[k(I(g(R)(G.value).format("ddd, DD MMM YY"))+"    ",1),n(b,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",{onKeydown:Pe(pe,["enter"]),ref_key:"heatMap",ref:U,style:{width:"100%",height:"600px"}},null,544),t("div",qe,[t("div",Ke,[t("div",Ge,[l.value?M("",!0):(r(),x("button",{key:0,style:{position:"relative","z-index":"2"},onClick:e[13]||(e[13]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[n(b,{icon:"play"})])),l.value?(r(),x("button",{key:1,style:{position:"relative","z-index":"2"},onClick:e[14]||(e[14]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[n(b,{icon:"pause"})])):M("",!0)]),t("div",He,[t("input",{style:{cursor:"pointer"},onChange:De,type:"range",min:0,max:i.initPlaybackData.length,value:u.value,class:"slider"},null,40,We)]),t("div",null,[!l.value&&u.value==i.initPlaybackData.length?(r(),x("button",{key:0,onClick:C,class:"controlbtn",type:"button"},[n(b,{icon:"undo"})])):M("",!0)])])])],64)}}}),Qe=we(Je,[["__scopeId","data-v-be8cb981"]]),Xe={class:"row"},Ze={class:"col-md-3"},et=["value"],tt={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},lt={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},at={class:"col-md-12",style:{position:"relative"}},ot={key:0,class:"loaders"},nt=xe({__name:"PlaybackFol",setup(de){const se=ge(),Q=be();Q.asideToggle(!1);const h=a(se.getAllTrunk()),y=a("trunk1"),i=a();i.value=Object.keys(h.value);const U=a(5),d=a(),A=a([]),u=a(0),q=a([]),O=a(!1),S=a(!1),w=a(!1),F=()=>{u.value++,A.value.push(null)};ke(()=>{$(),setTimeout(()=>{S.value=!0},1e3)}),D(()=>[d.value,U.value,y.value],async()=>{w.value=!0,await j()});const $=()=>{const v=new Date,o=v.getFullYear(),p=String(v.getMonth()+1).padStart(2,"0"),l=String(v.getDate()).padStart(2,"0"),f=`${o}-${p}-${l}`;d.value=f},Y=async v=>new Promise(async(o,p)=>{try{const l=h.value[y.value];let f=[];for(let L=0;L<l.spot.length;L++)f.push(l.spot[L].id);const B={datefilter:v,timeFilter:U.value,idFilter:f},X=await Ye.post(Ve.baseEnd+"api/History/getsplittedhistdata",B);o(X.data)}catch(l){p(l)}}),j=async()=>{try{O.value=!0;let o=[...await Y(d.value)];if(A.value.length>0){for(let p=0;p<A.value.length;p++){const l=A.value[p];if(l!==null){if(l.value!==d.value){const f=await Y(l.value);o=o.concat(f)}}else console.log("Null")}w.value=!1}q.value=o,O.value=!1}catch(v){console.log(v),w.value=!1,O.value=!1}},K=(v,o)=>{A.value[o]=v,j()},ie=()=>{u.value>0&&(u.value--,A.value.pop()),j()},G=v=>{d.value=v};return(v,o)=>{const p=ue("font-awesome-icon");return r(),ne($e,{"context-title":"Data Playback"},{default:m(()=>[t("div",Xe,[t("div",Ze,[o[4]||(o[4]=t("h4",null,[t("b",null,"Filter")],-1)),n(J,{"in-label":"Select Line","model-value":y.value,"onUpdate:modelValue":o[0]||(o[0]=l=>y.value=l)},{default:m(()=>[(r(!0),x(re,null,ye(i.value,(l,f)=>(r(),x("option",{key:f,value:l},I(h.value[l].name),9,et))),128))]),_:1},8,["model-value"]),n(J,{"in-label":"Time Range","model-value":U.value,"onUpdate:modelValue":o[1]||(o[1]=l=>U.value=l)},{default:m(()=>o[3]||(o[3]=[t("option",{value:"1"},"1 Minute",-1),t("option",{value:"2"},"2 Minutes",-1),t("option",{value:"3"},"3 Minutes",-1),t("option",{value:"4"},"4 Minutes",-1),t("option",{value:"5"},"5 Minutes",-1),t("option",{value:"10"},"10 Minutes",-1),t("option",{value:"15"},"15 Minutes",-1),t("option",{value:"30"},"30 Minutes",-1),t("option",{value:"60"},"60 Minutes",-1)])),_:1},8,["model-value"]),t("div",tt,[n(oe,{"in-type":"date","in-label":"Date Filter","model-value":d.value,"onUpdate:modelValue":o[2]||(o[2]=l=>d.value=l),style:{width:"100%"}},null,8,["model-value"])]),t("div",lt,[n(z,{onClick:ie,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:m(()=>[n(p,{icon:"minus"})]),_:1}),t("span",{class:E([`${g(Q).textTheme}`])},I(u.value),3),n(z,{onClick:F,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:m(()=>[n(p,{icon:"plus"})]),_:1})]),(r(!0),x(re,null,ye(u.value,(l,f)=>(r(),x("div",{key:f,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[n(oe,{"in-type":"date","in-label":`Date Filter ${l}`,onOnValueChange:B=>K(B,f),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",at,[O.value&&S.value?(r(),x("div",ot,o[5]||(o[5]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):M("",!0),S.value?(r(),ne(Qe,{key:1,"init-date-filter":d.value,"selected-spot":y.value,"init-playback-data":q.value,onOnDateChange:G},null,8,["init-date-filter","selected-spot","init-playback-data"])):M("",!0)])])]),_:1})}}}),yt=we(nt,[["__scopeId","data-v-8729811b"]]);export{yt as default};
