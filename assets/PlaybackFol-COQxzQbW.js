import{u as ce}from"./theme-DV-ZZQW5.js";import{_ as Ce}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DsZsd5pr.js";import{_ as H}from"./SelectView.vue_vue_type_style_index_0_lang-DmaAzWUF.js";import{_ as le}from"./InputView.vue_vue_type_style_index_0_lang-DE4aYrrh.js";import{_ as z}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-Dn6aS2_A.js";import{t as ye}from"./trunk-CuaAdnZJ.js";import{a as Se}from"./axios-BimPEqV4.js";import{d as me,e as a,j as be,l as D,r as se,o as v,c as g,g as t,a as o,w as c,q as k,m as C,n as j,u as b,y as ee,D as te,f as ae,t as U,h as Fe,H as $e,F as ie,_ as ge,z as fe,p as Ye}from"./index-C1DLBs-f.js";import{i as _e}from"./index-CehbAW_K.js";import{h as R}from"./moment-C5S46NFB.js";const Pe={key:0,class:"datepickdialog"},Ve={class:"datepickinner"},Te={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Re={key:1,class:"selfnavdialog"},ze={class:"selfnavdialog-inner"},Ae={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ue={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Le={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Ne={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Ie={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Be={key:1,style:{"font-size":"11px"}},Oe={style:{position:"relative"}},je={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Ee={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},qe={style:{width:"100%",padding:"10px",position:"relative"}},Ke=["max","value"],Ge=me({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0},isWaiting:{type:Boolean}},emits:["onDateChange"],setup(ue,{emit:oe}){const W=ye(),h=oe,y=ce(),u=ue,L=a(),x=a(),A=a(W.getAllTrunk()),r=a(0),E=a(0),O=a([]),S=a(500);let F=null;const $=a(!1),N=a(!1),w=a("forward");let K=[];const q={},ne=a(),p=a(""),i=a(""),d=a(!0),n=a(!1),l=a(!1),Y=a(!1),J=()=>{x.value=_e(L.value);const f={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};x.value.setOption(f)};be(()=>{window.addEventListener("keyup",de)}),D(()=>L.value,()=>{J(),I(r.value)}),D(()=>u.initPlaybackData,()=>{M(),J(),n.value&&(l.value=!0)});const I=f=>{K=[];for(let T of A.value[u.selectedSpot].spot)q[T.name]=[];u.initPlaybackData.slice(0,f+1).forEach((T,s)=>{const ve=`${T.dateFilter} (${T.timeRange})`;K.push(ve),ne.value=ve,T.data.forEach(pe=>{const De=A.value[u.selectedSpot].spot.find(Me=>Me.id===pe.idSpot).name,he=pe.avgPsiValues??0;q[De][s]=Number(he.toFixed(2))})});const m=Object.keys(q).map(T=>({name:T,type:"line",data:q[T],symbol:"none",smooth:!0,tooltip:{trigger:"axis",formatter:function(s){return s[0].value}},endLabel:{show:!0,formatter:function(s){return s.value},color:"#000",backgroundColor:"inherit",padding:5,borderRadius:5}}));x.value.setOption({xAxis:{data:K},series:m})},M=()=>{l.value=!1,r.value=0,O.value=[],clearInterval(F),I(r.value),E.value=r.value/u.initPlaybackData.length*100},xe=f=>{l.value=!1,O.value=[],r.value=parseInt(f.target.value,10),I(r.value),E.value=r.value/u.initPlaybackData.length*100};D(()=>u.initDateFilter,()=>{re()});const re=()=>{const f=R(u.initDateFilter),e=f.add(1,"days").format("YYYY-MM-DD"),m=f.subtract(2,"days").format("YYYY-MM-DD");p.value=e,i.value=m};re();const Q=()=>{Y.value=!0,M();const f=R(p.value).format("YYYY-MM-DD");n.value&&(l.value=!0),h("onDateChange",f),setTimeout(()=>{Y.value=!1},5e3)},X=()=>{Y.value=!0,M();const f=R(i.value).format("YYYY-MM-DD");n.value&&(l.value=!0),h("onDateChange",f),setTimeout(()=>{Y.value=!1},5e3)};D(()=>d.value,()=>{d.value&&(G(),$.value=!1,n.value=!1)}),D(()=>$.value,()=>{$.value?d.value=!1:d.value=!0}),D(()=>l.value,()=>{!l.value&&r.value==u.initPlaybackData.length&&(d.value?(M(),l.value=!0):(M(),l.value=!0,$.value&&(w.value=="forward"?_.value?(console.log(u.initDateFilter,P.value),u.initDateFilter!=V.value?Q():Z.value?(M(),h("onDateChange",P.value)):G()):Q():_.value?u.initDateFilter!=P.value?X():Z.value?(M(),h("onDateChange",V.value)):G():X())))}),D(()=>[l.value,S.value],()=>{l.value?(F!=null&&clearInterval(F),F=setInterval(()=>{r.value<u.initPlaybackData.length?(r.value++,u.initPlaybackData[r.value]!=null&&(I(r.value),E.value=r.value/u.initPlaybackData.length*100)):(l.value=!1,clearInterval(F))},S.value)):F&&(clearInterval(F),F=null)}),D(()=>[y.asideVisible],()=>{setTimeout(()=>{x.value.resize()},1e3)});const ke=()=>w.value=="forward"?p.value:i.value,B=a(!1),_=a(!1),Z=a(!0),P=a(""),V=a(""),we=()=>{P.value?V.value?(_.value=!0,d.value=!1,$.value=!0,n.value=!0,B.value=!1,l.value=!1):y.notifyShowError("Date 2 is required"):y.notifyShowError("Date 1 is required")};D(()=>B.value,()=>{B.value?(l.value=!1,_.value=!1):l.value=!0}),D(()=>[_.value],()=>{_.value&&(M(),w.value=="forward"?h("onDateChange",P.value):h("onDateChange",V.value))}),D(()=>w.value,()=>{w.value=="backward"&&(M(),G())});const G=()=>{M(),console.log(u.initDateFilter),h("onDateChange",u.initDateFilter),_.value=!1,P.value=null,V.value=null},de=f=>{(f.keyCode==80||f.keyCode==32)&&(l.value=!l.value),f.keyCode==37&&X(),f.keyCode==39&&Q()};return(f,e)=>{const m=se("font-awesome-icon"),T=se("center");return v(),g(ie,null,[B.value?(v(),g("div",Pe,[t("div",Ve,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),o(H,{"in-label":"Speed","model-value":S.value,"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s)},{default:c(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),o(le,{"in-type":"date","in-label":"Date 1","model-value":P.value,"onUpdate:modelValue":e[1]||(e[1]=s=>P.value=s)},null,8,["model-value"]),o(le,{"in-type":"date","in-label":"Date 2","model-value":V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s)},null,8,["model-value"]),t("div",Te,[o(z,{onClick:we,"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[16]||(e[16]=[k("Apply Filter")])),_:1}),o(z,{onClick:e[3]||(e[3]=s=>B.value=!B.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[17]||(e[17]=[k("Cancel")])),_:1})])])])):C("",!0),N.value?(v(),g("div",Re,[t("div",ze,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),o(H,{"in-label":"Direction","model-value":w.value,"onUpdate:modelValue":e[4]||(e[4]=s=>w.value=s)},{default:c(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),o(z,{onClick:e[5]||(e[5]=s=>N.value=!N.value),style:{width:"fit-content"},"bt-disabled":!1},{default:c(()=>[o(m,{icon:"save"}),e[21]||(e[21]=k(" Apply"))]),_:1})])])):C("",!0),e[31]||(e[31]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),o(T,null,{default:c(()=>[o(H,{style:{width:"400px"},"in-label":"Speed","model-value":S.value,"onUpdate:modelValue":e[6]||(e[6]=s=>S.value=s)},{default:c(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Ae,[t("div",Ue,[t("label",{class:j([`${b(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ee(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>d.value=s),type:"checkbox"},null,512),[[te,d.value]]),e[24]||(e[24]=k(" Auto-replay "))],2),t("label",{class:j([`${b(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ee(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value=s),type:"checkbox"},null,512),[[te,n.value]]),e[25]||(e[25]=k(" Autoplay on navigating "))],2),t("label",{class:j([`${b(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ee(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>$.value=s),type:"checkbox"},null,512),[[te,$.value]]),e[26]||(e[26]=k(" Self Navigate "))],2),$.value?(v(),ae(z,{key:0,onClick:e[10]||(e[10]=s=>N.value=!N.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(m,{icon:"sliders"})]),_:1})):C("",!0)]),t("div",Le,[_.value?(v(),g("label",{key:0,class:j([`${b(y).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[k(U(b(R)(P.value).format("ddd, DD MMM YY"))+"    ",1),o(m,{icon:w.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),k("    "+U(b(R)(V.value).format("ddd, DD MMM YY")),1)],2)):C("",!0),_.value?(v(),g("label",{key:1,class:j([`${b(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[ee(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>Z.value=s),type:"checkbox"},null,512),[[te,Z.value]]),e[27]||(e[27]=k(" Repeat "))],2)):C("",!0),o(z,{onClick:e[12]||(e[12]=s=>B.value=!B.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(m,{icon:"calendar"})]),_:1}),P.value&&V.value?(v(),ae(z,{key:2,onClick:G,"bt-disabled":!1,class:"slfnavbtn"},{default:c(()=>[o(m,{icon:"close"})]),_:1})):C("",!0)])]),t("div",Ne,[o(z,{"bt-disabled":Y.value,onClick:X},{default:c(()=>[o(m,{icon:"backward"}),k("    "+U(b(R)(i.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Ie,[t("b",{style:Fe({color:`${b(y).accentColor}`})},U(b(R)(u.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),_.value?(v(),g("span",{key:0,class:j([`${b(y).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=k("Stops at: ")),t("b",null,U(b(R)(V.value).format("ddd, DD MMM YY")),1)],2)):(v(),g("span",Be,[e[29]||(e[29]=k("Upcoming: ")),t("b",null,U(b(R)(ke()).format("ddd, DD MMM YY")),1)]))]),o(z,{"bt-disabled":Y.value,onClick:Q},{default:c(()=>[k(U(b(R)(p.value).format("ddd, DD MMM YY"))+"    ",1),o(m,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",{onKeydown:$e(de,["enter"]),ref_key:"heatMap",ref:L,style:{width:"100%",height:"600px"}},null,544),t("div",Oe,[t("div",je,[t("div",Ee,[l.value?C("",!0):(v(),g("button",{key:0,style:{position:"relative","z-index":"2"},onClick:e[13]||(e[13]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(m,{icon:"play"})])),l.value?(v(),g("button",{key:1,style:{position:"relative","z-index":"2"},onClick:e[14]||(e[14]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(m,{icon:"pause"})])):C("",!0)]),t("div",qe,[t("input",{style:{cursor:"pointer"},onChange:xe,type:"range",min:0,max:u.initPlaybackData.length,value:r.value,class:"slider"},null,40,Ke)]),t("div",null,[!l.value&&r.value==u.initPlaybackData.length?(v(),g("button",{key:0,onClick:M,class:"controlbtn",type:"button"},[o(m,{icon:"undo"})])):C("",!0)])])])],64)}}}),He=ge(Ge,[["__scopeId","data-v-4b83a5a1"]]),We={class:"row"},Je={class:"col-md-3"},Qe=["value"],Xe={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},Ze={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},et={class:"col-md-12",style:{position:"relative"}},tt={key:0,class:"loaders"},lt=me({__name:"PlaybackFol",setup(ue){const oe=ye(),W=ce();W.asideToggle(!1);const h=a(oe.getAllTrunk()),y=a("trunk1"),u=a();u.value=Object.keys(h.value);const L=a(5),x=a(),A=a([]),r=a(0),E=a([]),O=a(!1),S=a(!1),F=()=>{r.value++,A.value.push(null)};be(()=>{$(),setTimeout(()=>{S.value=!0},1e3)}),D(()=>[x.value,L.value,y.value],async()=>{await w()});const $=()=>{const p=new Date,i=p.getFullYear(),d=String(p.getMonth()+1).padStart(2,"0"),n=String(p.getDate()).padStart(2,"0"),l=`${i}-${d}-${n}`;x.value=l},N=async p=>new Promise(async(i,d)=>{try{const n=h.value[y.value];let l=[];for(let I=0;I<n.spot.length;I++)l.push(n.spot[I].id);const Y={datefilter:p,timeFilter:L.value,idFilter:l},J=await Se.post(Ye.baseEnd+"api/History/getsplittedhistdata",Y);i(J.data)}catch(n){d(n)}}),w=async()=>{try{O.value=!0;let i=[...await N(x.value)];if(A.value.length>0)for(let d=0;d<A.value.length;d++){const n=A.value[d];if(n!==null){if(n.value!==x.value){const l=await N(n.value);i=i.concat(l)}}else console.log("Null")}E.value=i,O.value=!1}catch(p){console.log(p),O.value=!1}},K=(p,i)=>{A.value[i]=p,w()},q=()=>{r.value>0&&(r.value--,A.value.pop()),w()},ne=p=>{x.value=p};return(p,i)=>{const d=se("font-awesome-icon");return v(),ae(Ce,{"context-title":"Data Playback"},{default:c(()=>[t("div",We,[t("div",Je,[i[4]||(i[4]=t("h4",null,[t("b",null,"Filter")],-1)),o(H,{"in-label":"Select Line","model-value":y.value,"onUpdate:modelValue":i[0]||(i[0]=n=>y.value=n)},{default:c(()=>[(v(!0),g(ie,null,fe(u.value,(n,l)=>(v(),g("option",{key:l,value:n},U(h.value[n].name),9,Qe))),128))]),_:1},8,["model-value"]),o(H,{"in-label":"Time Range","model-value":L.value,"onUpdate:modelValue":i[1]||(i[1]=n=>L.value=n)},{default:c(()=>i[3]||(i[3]=[t("option",{value:"1"},"1 Minute",-1),t("option",{value:"2"},"2 Minutes",-1),t("option",{value:"3"},"3 Minutes",-1),t("option",{value:"4"},"4 Minutes",-1),t("option",{value:"5"},"5 Minutes",-1),t("option",{value:"10"},"10 Minutes",-1),t("option",{value:"15"},"15 Minutes",-1),t("option",{value:"30"},"30 Minutes",-1),t("option",{value:"60"},"60 Minutes",-1)])),_:1},8,["model-value"]),t("div",Xe,[o(le,{"in-type":"date","in-label":"Date Filter","model-value":x.value,"onUpdate:modelValue":i[2]||(i[2]=n=>x.value=n),style:{width:"100%"}},null,8,["model-value"])]),t("div",Ze,[o(z,{onClick:q,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(d,{icon:"minus"})]),_:1}),t("span",{class:j([`${b(W).textTheme}`])},U(r.value),3),o(z,{onClick:F,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(d,{icon:"plus"})]),_:1})]),(v(!0),g(ie,null,fe(r.value,(n,l)=>(v(),g("div",{key:l,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[o(le,{"in-type":"date","in-label":`Date Filter ${n}`,onOnValueChange:Y=>K(Y,l),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",et,[O.value&&S.value?(v(),g("div",tt,i[5]||(i[5]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):C("",!0),S.value?(v(),ae(He,{key:1,"init-date-filter":x.value,"selected-spot":y.value,"init-playback-data":E.value,onOnDateChange:ne},null,8,["init-date-filter","selected-spot","init-playback-data"])):C("",!0)])])]),_:1})}}}),ft=ge(lt,[["__scopeId","data-v-90126269"]]);export{ft as default};
