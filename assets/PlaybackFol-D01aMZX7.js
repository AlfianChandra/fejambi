import{u as xe}from"./theme-dRgDQ400.js";import{_ as Te}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DMw5B_Y0.js";import{_ as X}from"./SelectView.vue_vue_type_style_index_0_lang-Czcry4qk.js";import{_ as ne}from"./InputView.vue_vue_type_style_index_0_lang-C7a5L7L3.js";import{_ as S}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-DxU5ySqI.js";import{t as we}from"./trunk-CuaAdnZJ.js";import{a as Ve}from"./axios-BimPEqV4.js";import{d as ke,e as a,k as be,j as De,l as h,r as de,o as c,c as x,g as t,a as o,w as f,q as b,m as F,n as j,u as g,y as ae,D as oe,f as se,t as I,h as Le,H as ze,F as ve,_ as he,z as ge,p as Ae}from"./index-Cdz-UBof.js";import{i as Ie}from"./index-CehbAW_K.js";import{h as L}from"./moment-C5S46NFB.js";const Re={key:0,class:"datepickdialog"},Ue={class:"datepickinner"},Oe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ne={key:1,class:"selfnavdialog"},je={class:"selfnavdialog-inner"},Be={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ee={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},qe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Ge={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Ke={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},He={key:1,style:{"font-size":"11px"}},We={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},Je={style:{position:"relative"}},Qe={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Xe={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},Ze={style:{width:"100%",padding:"10px",position:"relative"}},et=["max","value"],tt=ke({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange","onAutoRepChanged","onAutoplayChanged","onSelfNavChanged","onDirectionChanged"],setup(pe,{emit:ie}){const Z=we(),C=ie,y=xe(),r=pe,R=a(),u=a(),z=a(Z.getAllTrunk()),d=a(0),B=a(0),N=a([]),$=a(250);let k=null;const D=a(!1),Y=a("forward");let A=null,E=[],U={};const ue=a(),q=a(""),G=a(""),v=a(!0),n=a(!1),l=a(!1),i=a(!1),w=a(!1),K={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(p){return p.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]},re=a({grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(p){return p.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]}),W=()=>{u.value=Ie(R.value),u.value.setOption(K),setTimeout(()=>{u.value.dispatchAction({type:"legendInverseSelect"}),u.value.dispatchAction({type:"legendAllSelect"})},100)};A=setInterval(()=>{u.value&&u.value&&u.value.resize()},1e3),be(()=>{clearInterval(A)}),De(()=>{window.addEventListener("keyup",ce),A||(A=setInterval(()=>{u.value&&u.value.resize()},1e3))}),be(()=>{A&&(clearInterval(A),A=null)}),h(()=>R.value,()=>{W(),H(d.value)}),h(()=>r.initPlaybackData,()=>{u.value&&u.value.setOption(re.value,{notMerge:!0}),H(d.value)});const H=p=>{E=[];for(let M of z.value[r.selectedSpot].spot)U[M.name]=[];r.initPlaybackData.slice(0,p+1).forEach((M,s)=>{const ye=`${M.dateFilter} (${M.timeRange})`;E.push(ye),ue.value=ye,M.data.forEach(me=>{const Ye=z.value[r.selectedSpot].spot.find(Pe=>Pe.id===me.idSpot).name,_e=me.avgPsiValues??0;U[Ye][s]=Number(_e.toFixed(2))})});const m=Object.keys(U).map(M=>({name:M,type:"line",data:U[M],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(s){return s[0].value}},endLabel:{show:!0,formatter:function(s){return s.value+" ; "+M},color:"#000",fontSize:10,backgroundColor:"inherit",padding:5,borderRadius:5}}));u.value.setOption({xAxis:{data:E},series:m})},_=()=>{l.value=!1,d.value=0,N.value=[],clearInterval(k),H(d.value),B.value=d.value/r.initPlaybackData.length*100},Se=p=>{l.value=!1,N.value=[],d.value=parseInt(p.target.value,10),H(d.value),B.value=d.value/r.initPlaybackData.length*100};h(()=>r.initDateFilter,()=>{fe()});const fe=()=>{const p=L(r.initDateFilter),e=p.add(1,"days").format("YYYY-MM-DD"),m=p.subtract(2,"days").format("YYYY-MM-DD");q.value=e,G.value=m};fe();const ee=()=>{i.value=!0,_();const p=L(q.value).format("YYYY-MM-DD");n.value&&(l.value=!0),w.value=!0,C("onDateChange",p),setTimeout(()=>{i.value=!1},5e3)},te=()=>{i.value=!0,_();const p=L(G.value).format("YYYY-MM-DD");n.value&&(l.value=!0),w.value=!0,C("onDateChange",p),setTimeout(()=>{i.value=!1},5e3)};h(()=>v.value,()=>{v.value&&(Q(),D.value=!1,n.value=!1)}),h(()=>D.value,()=>{D.value?v.value=!1:v.value=!0}),h(()=>l.value,()=>{!l.value&&d.value==r.initPlaybackData.length&&(v.value?(_(),l.value=!0):D.value?Y.value=="forward"?P.value?(console.log(r.initDateFilter,T.value),r.initDateFilter!=V.value?ee():le.value?(_(),C("onDateChange",T.value)):Q()):ee():P.value?r.initDateFilter!=T.value?te():le.value?(_(),C("onDateChange",V.value)):Q():te():(_(),l.value=!1))}),h(()=>[l.value,$.value],()=>{l.value?(k!=null&&clearInterval(k),k=setInterval(()=>{d.value<r.initPlaybackData.length?(d.value++,r.initPlaybackData[d.value]!=null&&(H(d.value),B.value=d.value/r.initPlaybackData.length*100)):(l.value=!1,clearInterval(k))},$.value)):k&&(clearInterval(k),k=null)}),h(()=>[y.asideVisible],()=>{setTimeout(()=>{u.value.resize()},1e3)});const J=a(!1),Ce=()=>Y.value=="forward"?q.value:G.value,O=a(!1),P=a(!1),le=a(!0),T=a(""),V=a(""),Me=()=>{T.value?V.value?(P.value=!0,v.value=!1,D.value=!0,n.value=!0,O.value=!1,l.value=!1):y.notifyShowError("Date 2 is required"):y.notifyShowError("Date 1 is required")};h(()=>O.value,()=>{O.value?(l.value=!1,P.value=!1):l.value=!0}),h(()=>[P.value],()=>{P.value&&(_(),Y.value=="forward"?C("onDateChange",T.value):C("onDateChange",V.value))}),h(()=>Y.value,()=>{Y.value=="backward"&&(_(),Q())});const Q=()=>{_(),console.log(r.initDateFilter),C("onDateChange",r.initDateFilter),P.value=!1,T.value=null,V.value=null},ce=p=>{(p.keyCode==80||p.keyCode==32)&&(l.value=!l.value),p.keyCode==37&&te(),p.keyCode==39&&ee()},Fe=()=>{u.value.setOption({})},$e=()=>{u.value.setOption(K),H(d.value)};return(p,e)=>{const m=de("font-awesome-icon"),M=de("center");return c(),x(ve,null,[O.value?(c(),x("div",Re,[t("div",Ue,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),o(X,{"in-label":"Speed","model-value":$.value,"onUpdate:modelValue":e[0]||(e[0]=s=>$.value=s)},{default:f(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),o(ne,{"in-type":"date","in-label":"Date 1","model-value":T.value,"onUpdate:modelValue":e[1]||(e[1]=s=>T.value=s)},null,8,["model-value"]),o(ne,{"in-type":"date","in-label":"Date 2","model-value":V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s)},null,8,["model-value"]),t("div",Oe,[o(S,{onClick:Me,"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[16]||(e[16]=[b("Apply Filter")])),_:1}),o(S,{onClick:e[3]||(e[3]=s=>O.value=!O.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[17]||(e[17]=[b("Cancel")])),_:1})])])])):F("",!0),J.value?(c(),x("div",Ne,[t("div",je,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),o(X,{"in-label":"Direction","model-value":Y.value,"onUpdate:modelValue":e[4]||(e[4]=s=>Y.value=s)},{default:f(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),o(S,{onClick:e[5]||(e[5]=s=>J.value=!J.value),style:{width:"fit-content"},"bt-disabled":!1},{default:f(()=>[o(m,{icon:"save"}),e[21]||(e[21]=b(" Apply"))]),_:1})])])):F("",!0),e[33]||(e[33]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),o(M,null,{default:f(()=>[o(X,{style:{width:"400px"},"in-label":"Speed","model-value":$.value,"onUpdate:modelValue":e[6]||(e[6]=s=>$.value=s)},{default:f(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Be,[t("div",Ee,[t("label",{class:j([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>v.value=s),type:"checkbox"},null,512),[[oe,v.value]]),e[24]||(e[24]=b(" Auto-replay "))],2),t("label",{class:j([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value=s),type:"checkbox"},null,512),[[oe,n.value]]),e[25]||(e[25]=b(" Autoplay on navigating "))],2),t("label",{class:j([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>D.value=s),type:"checkbox"},null,512),[[oe,D.value]]),e[26]||(e[26]=b(" Self Navigate "))],2),D.value?(c(),se(S,{key:0,onClick:e[10]||(e[10]=s=>J.value=!J.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[o(m,{icon:"sliders"})]),_:1})):F("",!0)]),t("div",qe,[P.value?(c(),x("label",{key:0,class:j([`${g(y).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[b(I(g(L)(T.value).format("ddd, DD MMM YY"))+"    ",1),o(m,{icon:Y.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),b("    "+I(g(L)(V.value).format("ddd, DD MMM YY")),1)],2)):F("",!0),P.value?(c(),x("label",{key:1,class:j([`${g(y).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>le.value=s),type:"checkbox"},null,512),[[oe,le.value]]),e[27]||(e[27]=b(" Repeat "))],2)):F("",!0),o(S,{onClick:e[12]||(e[12]=s=>O.value=!O.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[o(m,{icon:"calendar"})]),_:1}),T.value&&V.value?(c(),se(S,{key:2,onClick:Q,"bt-disabled":!1,class:"slfnavbtn"},{default:f(()=>[o(m,{icon:"close"})]),_:1})):F("",!0)])]),t("div",Ge,[o(S,{"bt-disabled":i.value,onClick:te},{default:f(()=>[o(m,{icon:"backward"}),b("    "+I(g(L)(G.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Ke,[t("b",{style:Le({color:`${g(y).accentColor}`})},I(g(L)(r.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),P.value?(c(),x("span",{key:0,class:j([`${g(y).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=b("Stops at: ")),t("b",null,I(g(L)(V.value).format("ddd, DD MMM YY")),1)],2)):(c(),x("span",He,[e[29]||(e[29]=b("Upcoming: ")),t("b",null,I(g(L)(Ce()).format("ddd, DD MMM YY")),1)]))]),o(S,{"bt-disabled":i.value,onClick:ee},{default:f(()=>[b(I(g(L)(q.value).format("ddd, DD MMM YY"))+"    ",1),o(m,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",We,[o(S,{"bt-size":"small",onClick:$e,"bt-disabled":!1},{default:f(()=>[o(m,{icon:"eye"}),e[31]||(e[31]=b(" Show All Legends"))]),_:1}),o(S,{"bt-size":"small",onClick:Fe,"bt-disabled":!1},{default:f(()=>[o(m,{icon:"eye-slash"}),e[32]||(e[32]=b(" Clear Legends"))]),_:1})]),t("div",{onKeydown:ze(ce,["enter"]),ref_key:"heatMap",ref:R,style:{width:"100%",height:"600px"}},null,544),t("div",Je,[t("div",Qe,[t("div",Xe,[l.value?F("",!0):(c(),x("button",{key:0,style:{position:"relative","z-index":"2"},onClick:e[13]||(e[13]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(m,{icon:"play"})])),l.value?(c(),x("button",{key:1,style:{position:"relative","z-index":"2"},onClick:e[14]||(e[14]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(m,{icon:"pause"})])):F("",!0)]),t("div",Ze,[t("input",{style:{cursor:"pointer"},onChange:Se,type:"range",min:0,max:r.initPlaybackData.length,value:d.value,class:"slider"},null,40,et)]),t("div",null,[!l.value&&d.value==r.initPlaybackData.length?(c(),x("button",{key:0,onClick:_,class:"controlbtn",type:"button"},[o(m,{icon:"undo"})])):F("",!0)])])])],64)}}}),lt=he(tt,[["__scopeId","data-v-3722164f"]]),at={class:"row"},ot={class:"col-md-3"},nt=["value"],st={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},it={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},ut={class:"col-md-12",style:{position:"relative"}},rt={key:0,class:"loaders"},dt=ke({__name:"PlaybackFol",setup(pe){const ie=we(),Z=xe();Z.asideToggle(!1);const C=a(ie.getAllTrunk()),y=a("trunk1"),r=a();r.value=Object.keys(C.value);const R=a(5),u=a(),z=a([]),d=a(0),B=a([]),N=a(!1),$=a(!1),k=a(!1),D=a(!1),Y=()=>{d.value++,z.value.push(null)};De(()=>{A(),setTimeout(()=>{$.value=!0},1e3)}),h(()=>[u.value,R.value,y.value],async()=>{D.value=!1,k.value=!0,await U()});const A=()=>{const v=new Date,n=v.getFullYear(),l=String(v.getMonth()+1).padStart(2,"0"),i=String(v.getDate()).padStart(2,"0"),w=`${n}-${l}-${i}`;u.value=w},E=async v=>new Promise(async(n,l)=>{try{const i=C.value[y.value];let w=[];for(let W=0;W<i.spot.length;W++)w.push(i.spot[W].id);const K={datefilter:v,timeFilter:R.value,idFilter:w},re=await Ve.post(Ae.baseEnd+"api/History/getsplittedhistdata",K);n(re.data)}catch(i){l(i)}}),U=async()=>{try{N.value=!0;let n=[...await E(u.value)];if(z.value.length>0){for(let l=0;l<z.value.length;l++){const i=z.value[l];if(i!==null){if(i.value!==u.value){const w=await E(i.value);n=n.concat(w)}}else console.log("Null")}k.value=!1}B.value=n,N.value=!1,D.value=!0}catch(v){console.log(v),k.value=!1,N.value=!1}},ue=(v,n)=>{z.value[n]=v,U()},q=()=>{d.value>0&&(d.value--,z.value.pop()),U()},G=v=>{u.value=v};return(v,n)=>{const l=de("font-awesome-icon");return c(),se(Te,{"context-title":"Data Playback"},{default:f(()=>[t("div",at,[t("div",ot,[n[4]||(n[4]=t("h4",null,[t("b",null,"Filter")],-1)),o(X,{"in-label":"Select Line","model-value":y.value,"onUpdate:modelValue":n[0]||(n[0]=i=>y.value=i)},{default:f(()=>[(c(!0),x(ve,null,ge(r.value,(i,w)=>(c(),x("option",{key:w,value:i},I(C.value[i].name),9,nt))),128))]),_:1},8,["model-value"]),o(X,{"in-label":"Time Range","model-value":R.value,"onUpdate:modelValue":n[1]||(n[1]=i=>R.value=i)},{default:f(()=>n[3]||(n[3]=[t("option",{value:"1"},"1 Minute",-1),t("option",{value:"2"},"2 Minutes",-1),t("option",{value:"3"},"3 Minutes",-1),t("option",{value:"4"},"4 Minutes",-1),t("option",{value:"5"},"5 Minutes",-1),t("option",{value:"10"},"10 Minutes",-1),t("option",{value:"15"},"15 Minutes",-1),t("option",{value:"30"},"30 Minutes",-1),t("option",{value:"60"},"60 Minutes",-1)])),_:1},8,["model-value"]),t("div",st,[o(ne,{"in-type":"date","in-label":"Date Filter","model-value":u.value,"onUpdate:modelValue":n[2]||(n[2]=i=>u.value=i),style:{width:"100%"}},null,8,["model-value"])]),t("div",it,[o(S,{onClick:q,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[o(l,{icon:"minus"})]),_:1}),t("span",{class:j([`${g(Z).textTheme}`])},I(d.value),3),o(S,{onClick:Y,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[o(l,{icon:"plus"})]),_:1})]),(c(!0),x(ve,null,ge(d.value,(i,w)=>(c(),x("div",{key:w,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[o(ne,{"in-type":"date","in-label":`Date Filter ${i}`,onOnValueChange:K=>ue(K,w),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",ut,[N.value&&$.value?(c(),x("div",rt,n[5]||(n[5]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):F("",!0),$.value&&D.value?(c(),se(lt,{key:1,"init-date-filter":u.value,"selected-spot":y.value,"init-playback-data":B.value,onOnDateChange:G},null,8,["init-date-filter","selected-spot","init-playback-data"])):F("",!0)])])]),_:1})}}}),kt=he(dt,[["__scopeId","data-v-f2bb1fbc"]]);export{kt as default};
