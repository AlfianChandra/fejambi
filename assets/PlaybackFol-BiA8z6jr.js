import{u as xe}from"./theme-c8omi_G4.js";import{_ as Te}from"./MainWrapperView.vue_vue_type_style_index_0_lang-CQnhUN6k.js";import{_ as Q}from"./SelectView.vue_vue_type_style_index_0_lang-BiTlhAoj.js";import{_ as oe}from"./InputView.vue_vue_type_style_index_0_lang-DDFxUwmY.js";import{_ as M}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-8r-enIP1.js";import{t as we}from"./trunk-CuaAdnZJ.js";import{a as Ve}from"./axios-BimPEqV4.js";import{d as ke,e as a,k as be,j as De,l as h,r as ve,o as v,c as y,g as t,a as o,w as c,q as g,m as F,n as j,u as x,y as le,D as ae,f as ne,t as L,h as Le,F as se,H as Ae,_ as he,z as ge,p as ze}from"./index-CXyP7EXo.js";import{i as Re}from"./index-CehbAW_K.js";import{h as k}from"./moment-C5S46NFB.js";const Ie={key:0,class:"datepickdialog"},Ue={class:"datepickinner"},Oe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ne={key:1,class:"selfnavdialog"},je={class:"selfnavdialog-inner"},Be={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ee={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},qe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Ge={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Ke={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},He={key:0,style:{"font-size":"11px"}},We={key:1,style:{"font-size":"11px"}},Je={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},Qe={style:{position:"relative"}},Xe={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Ze={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},et={style:{width:"100%",padding:"10px",position:"relative"}},tt=["max","value"],lt=ke({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange","onAutoRepChanged","onAutoplayChanged","onSelfNavChanged","onDirectionChanged"],setup(pe,{emit:ie}){const X=we(),S=ie,m=xe(),d=pe,I=a(),f=a(),A=a(X.getAllTrunk()),u=a(0),B=a(0),O=a([]),_=a(250);let D=null;const C=a(!1),P=a("forward");let ue=null,E=[],z={};const re=a(),N=a(""),q=a(""),r=a(!0),n=a(!1),l=a(!1),i=a(!1),w=a(!1),G={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(p){return p.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]},de=a({grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(p){return p.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]}),K=()=>{f.value=Re(I.value),f.value.setOption(G),setTimeout(()=>{f.value.dispatchAction({type:"legendInverseSelect"}),f.value.dispatchAction({type:"legendAllSelect"})},100)};be(()=>{clearInterval(ue)}),De(()=>{window.addEventListener("keyup",ce)}),be(()=>{}),h(()=>I.value,()=>{K(),H(u.value)}),h(()=>d.initPlaybackData,()=>{f.value&&f.value.setOption(de.value,{notMerge:!0}),H(u.value),Y(),K(),w.value=!1,n.value&&(l.value=!0)});const H=p=>{E=[];for(let $ of A.value[d.selectedSpot].spot)z[$.name]=[];d.initPlaybackData.slice(0,p+1).forEach(($,s)=>{const ye=`${$.dateFilter} (${$.timeRange})`;E.push(ye),re.value=ye,$.data.forEach(me=>{const Fe=A.value[d.selectedSpot].spot.find(Pe=>Pe.id===me.idSpot).name,_e=me.avgPsiValues??0;z[Fe][s]=Number(_e.toFixed(2))})});const b=Object.keys(z).map($=>({name:$,type:"line",data:z[$],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(s){return s[0].value}},endLabel:{show:!0,formatter:function(s){return s.value+" ; "+$},color:"#000",fontSize:10,backgroundColor:"inherit",padding:5,borderRadius:5}}));f.value.setOption({xAxis:{data:E},series:b}),console.log(z.value)},Y=()=>{l.value=!1,u.value=0,O.value=[],clearInterval(D),H(u.value),B.value=u.value/d.initPlaybackData.length*100},Me=p=>{l.value=!1,O.value=[],u.value=parseInt(p.target.value,10),H(u.value),B.value=u.value/d.initPlaybackData.length*100};h(()=>d.initDateFilter,()=>{fe()});const fe=()=>{const p=k(d.initDateFilter),e=p.add(1,"days").format("YYYY-MM-DD"),b=p.subtract(2,"days").format("YYYY-MM-DD");N.value=e,q.value=b};fe();const Z=()=>{i.value=!0,Y();const p=k(N.value).format("YYYY-MM-DD");n.value&&(l.value=!0),w.value=!0,S("onDateChange",p),setTimeout(()=>{i.value=!1},5e3)},ee=()=>{i.value=!0,Y();const p=k(q.value).format("YYYY-MM-DD");n.value&&(l.value=!0),w.value=!0,S("onDateChange",p),setTimeout(()=>{i.value=!1},5e3)};h(()=>r.value,()=>{r.value&&(J(),C.value=!1,n.value=!1)}),h(()=>C.value,()=>{C.value?r.value=!1:r.value=!0}),h(()=>l.value,()=>{!l.value&&u.value==d.initPlaybackData.length&&(r.value?(Y(),l.value=!0):C.value?P.value=="forward"?T.value?d.initDateFilter!=V.value?Z():te.value?(Y(),S("onDateChange",R.value)):J():Z():T.value?d.initDateFilter!=R.value?ee():te.value?(Y(),S("onDateChange",V.value)):J():ee():(Y(),l.value=!1),k(N.value).format("YYYY-MM-DD")==k().format("YYYY-MM-DD")&&(l.value=!1))}),h(()=>[l.value,_.value],()=>{l.value?(D!=null&&clearInterval(D),D=setInterval(()=>{u.value<d.initPlaybackData.length?(u.value++,d.initPlaybackData[u.value]!=null&&(H(u.value),B.value=u.value/d.initPlaybackData.length*100)):(l.value=!1,clearInterval(D))},_.value)):D&&(clearInterval(D),D=null)}),h(()=>[m.asideVisible],()=>{setTimeout(()=>{f.value.resize()},1e3)});const W=a(!1),Se=()=>P.value=="forward"?N.value:q.value,U=a(!1),T=a(!1),te=a(!0),R=a(""),V=a(""),Ce=()=>{R.value?V.value?(T.value=!0,r.value=!1,C.value=!0,n.value=!0,U.value=!1,l.value=!1):m.notifyShowError("Date 2 is required"):m.notifyShowError("Date 1 is required")};h(()=>U.value,()=>{U.value?(l.value=!1,T.value=!1):l.value=!0}),h(()=>[T.value],()=>{T.value&&(Y(),P.value=="forward"?S("onDateChange",R.value):S("onDateChange",V.value))}),h(()=>P.value,()=>{P.value=="backward"&&(Y(),J())});const J=()=>{Y(),S("onDateChange",d.initDateFilter),T.value=!1,R.value=null,V.value=null},ce=p=>{(p.keyCode==80||p.keyCode==32)&&(l.value=!l.value),p.keyCode==37&&ee(),p.keyCode==39&&Z()},Ye=()=>{f.value.setOption({})},$e=()=>{f.value.setOption(G),H(u.value)};return(p,e)=>{const b=ve("font-awesome-icon"),$=ve("center");return v(),y(se,null,[U.value?(v(),y("div",Ie,[t("div",Ue,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),o(Q,{"in-label":"Speed","model-value":_.value,"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s)},{default:c(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),o(oe,{"in-type":"date","in-label":"Date 1","model-value":R.value,"onUpdate:modelValue":e[1]||(e[1]=s=>R.value=s)},null,8,["model-value"]),o(oe,{"in-type":"date","in-label":"Date 2","model-value":V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s)},null,8,["model-value"]),t("div",Oe,[o(M,{onClick:Ce,"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[16]||(e[16]=[g("Apply Filter")])),_:1}),o(M,{onClick:e[3]||(e[3]=s=>U.value=!U.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[17]||(e[17]=[g("Cancel ")])),_:1})])])])):F("",!0),W.value?(v(),y("div",Ne,[t("div",je,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),o(Q,{"in-label":"Direction","model-value":P.value,"onUpdate:modelValue":e[4]||(e[4]=s=>P.value=s)},{default:c(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),o(M,{onClick:e[5]||(e[5]=s=>W.value=!W.value),style:{width:"fit-content"},"bt-disabled":!1},{default:c(()=>[o(b,{icon:"save"}),e[21]||(e[21]=g(" Apply"))]),_:1})])])):F("",!0),e[34]||(e[34]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),o($,null,{default:c(()=>[o(Q,{style:{width:"400px"},"in-label":"Speed","model-value":_.value,"onUpdate:modelValue":e[6]||(e[6]=s=>_.value=s)},{default:c(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Be,[t("div",Ee,[t("label",{class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>r.value=s),type:"checkbox"},null,512),[[ae,r.value]]),e[24]||(e[24]=g(" Auto-replay "))],2),t("label",{class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value=s),type:"checkbox"},null,512),[[ae,n.value]]),e[25]||(e[25]=g(" Autoplay on navigating "))],2),t("label",{class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>C.value=s),type:"checkbox"},null,512),[[ae,C.value]]),e[26]||(e[26]=g(" Self Navigate "))],2),C.value?(v(),ne(M,{key:0,onClick:e[10]||(e[10]=s=>W.value=!W.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(b,{icon:"sliders"})]),_:1})):F("",!0)]),t("div",qe,[T.value?(v(),y("label",{key:0,class:j([`${x(m).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[g(L(x(k)(R.value).format("ddd, DD MMM YY"))+"    ",1),o(b,{icon:P.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),g("    "+L(x(k)(V.value).format("ddd, DD MMM YY")),1)],2)):F("",!0),T.value?(v(),y("label",{key:1,class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>te.value=s),type:"checkbox"},null,512),[[ae,te.value]]),e[27]||(e[27]=g(" Repeat "))],2)):F("",!0),o(M,{onClick:e[12]||(e[12]=s=>U.value=!U.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(b,{icon:"calendar"})]),_:1}),R.value&&V.value?(v(),ne(M,{key:2,onClick:J,"bt-disabled":!1,class:"slfnavbtn"},{default:c(()=>[o(b,{icon:"close"})]),_:1})):F("",!0)])]),t("div",Ge,[o(M,{"bt-disabled":i.value,onClick:ee},{default:c(()=>[o(b,{icon:"backward"}),g("    "+L(x(k)(q.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Ke,[t("b",{style:Le({color:`${x(m).accentColor}`})},L(x(k)(d.initDateFilter).format("ddd, DD MMM YY")),5),e[31]||(e[31]=t("br",null,null,-1)),T.value?(v(),y("span",{key:0,class:j([`${x(m).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=g("Stops at: ")),t("b",null,L(x(k)(V.value).format("ddd, DD MMM YY")),1)],2)):(v(),y(se,{key:1},[r.value?(v(),y("span",He,[e[29]||(e[29]=g("Repeating: ")),t("b",null,L(x(k)(d.initDateFilter).format("ddd, DD MMM YY")),1)])):(v(),y("span",We,[e[30]||(e[30]=g("Upcoming: ")),t("b",null,L(x(k)(Se()).format("ddd, DD MMM YY")),1)]))],64))]),o(M,{"bt-disabled":i.value,onClick:Z},{default:c(()=>[g(L(x(k)(N.value).format("ddd, DD MMM YY"))+"    ",1),o(b,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Je,[o(M,{"bt-size":"small",onClick:$e,"bt-disabled":!1},{default:c(()=>[o(b,{icon:"eye"}),e[32]||(e[32]=g(" Show All Legends"))]),_:1}),o(M,{"bt-size":"small",onClick:Ye,"bt-disabled":!1},{default:c(()=>[o(b,{icon:"eye-slash"}),e[33]||(e[33]=g(" Clear Legends"))]),_:1})]),t("div",{onKeydown:Ae(ce,["enter"]),ref_key:"heatMap",ref:I,style:{width:"100%",height:"600px"}},null,544),t("div",Qe,[t("div",Xe,[t("div",Ze,[l.value?F("",!0):(v(),y("button",{key:0,style:{position:"relative","z-index":"2"},onClick:e[13]||(e[13]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(b,{icon:"play"})])),l.value?(v(),y("button",{key:1,style:{position:"relative","z-index":"2"},onClick:e[14]||(e[14]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(b,{icon:"pause"})])):F("",!0)]),t("div",et,[t("input",{style:{cursor:"pointer"},onChange:Me,type:"range",min:0,max:d.initPlaybackData.length,value:u.value,class:"slider"},null,40,tt)]),t("div",null,[!l.value&&u.value==d.initPlaybackData.length?(v(),y("button",{key:0,onClick:Y,class:"controlbtn",type:"button"},[o(b,{icon:"undo"})])):F("",!0)])])])],64)}}}),at=he(lt,[["__scopeId","data-v-0bffc1d6"]]),ot={class:"row"},nt={class:"col-md-3"},st=["value"],it={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},ut={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},rt={class:"col-md-12",style:{position:"relative"}},dt={key:0,class:"loaders"},vt=ke({__name:"PlaybackFol",setup(pe){const ie=we(),X=xe();X.asideToggle(!1);const S=a(ie.getAllTrunk()),m=a("trunk1"),d=a();d.value=Object.keys(S.value);const I=a(5),f=a(),A=a([]),u=a(0),B=a([]),O=a(!1),_=a(!1),D=a(!1),C=a(!1),P=()=>{u.value++,A.value.push(null)};De(()=>{ue(),setTimeout(()=>{_.value=!0},1e3)}),h(()=>[f.value,I.value,m.value],async()=>{C.value=!1,D.value=!0,await z()});const ue=()=>{const r=new Date,n=r.getFullYear(),l=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0"),w=`${n}-${l}-${i}`;f.value=w},E=async r=>new Promise(async(n,l)=>{try{const i=S.value[m.value];let w=[];for(let K=0;K<i.spot.length;K++)w.push(i.spot[K].id);const G={datefilter:r,timeFilter:I.value,idFilter:w},de=await Ve.post(ze.baseEnd+"api/History/getsplittedhistdata",G);n(de.data)}catch(i){l(i)}}),z=async()=>{try{O.value=!0;let n=[...await E(f.value)];if(A.value.length>0){for(let l=0;l<A.value.length;l++){const i=A.value[l];if(i!==null){if(i.value!==f.value){const w=await E(i.value);n=n.concat(w)}}else console.log("Null")}D.value=!1}B.value=n,O.value=!1,C.value=!0}catch(r){console.log(r),D.value=!1,O.value=!1}},re=(r,n)=>{A.value[n]=r,z()},N=()=>{u.value>0&&(u.value--,A.value.pop()),z()},q=r=>{f.value=r};return(r,n)=>{const l=ve("font-awesome-icon");return v(),ne(Te,{"context-title":"Data Playback"},{default:c(()=>[t("div",ot,[t("div",nt,[n[4]||(n[4]=t("h4",null,[t("b",null,"Filter")],-1)),o(Q,{"in-label":"Select Line","model-value":m.value,"onUpdate:modelValue":n[0]||(n[0]=i=>m.value=i)},{default:c(()=>[(v(!0),y(se,null,ge(d.value,(i,w)=>(v(),y("option",{key:w,value:i},L(S.value[i].name),9,st))),128))]),_:1},8,["model-value"]),o(Q,{"in-label":"Time Range","model-value":I.value,"onUpdate:modelValue":n[1]||(n[1]=i=>I.value=i)},{default:c(()=>n[3]||(n[3]=[t("option",{value:"1"},"1 Minute",-1),t("option",{value:"2"},"2 Minutes",-1),t("option",{value:"3"},"3 Minutes",-1),t("option",{value:"4"},"4 Minutes",-1),t("option",{value:"5"},"5 Minutes",-1),t("option",{value:"10"},"10 Minutes",-1),t("option",{value:"15"},"15 Minutes",-1),t("option",{value:"30"},"30 Minutes",-1),t("option",{value:"60"},"60 Minutes",-1)])),_:1},8,["model-value"]),t("div",it,[o(oe,{"in-type":"date","in-label":"Date Filter","model-value":f.value,"onUpdate:modelValue":n[2]||(n[2]=i=>f.value=i),style:{width:"100%"}},null,8,["model-value"])]),t("div",ut,[o(M,{onClick:N,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(l,{icon:"minus"})]),_:1}),t("span",{class:j([`${x(X).textTheme}`])},L(u.value),3),o(M,{onClick:P,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(l,{icon:"plus"})]),_:1})]),(v(!0),y(se,null,ge(u.value,(i,w)=>(v(),y("div",{key:w,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[o(oe,{"in-type":"date","in-label":`Date Filter ${i}`,onOnValueChange:G=>re(G,w),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",rt,[O.value&&_.value?(v(),y("div",dt,n[5]||(n[5]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):F("",!0),_.value?(v(),ne(at,{key:1,"init-date-filter":f.value,"selected-spot":m.value,"init-playback-data":B.value,onOnDateChange:q},null,8,["init-date-filter","selected-spot","init-playback-data"])):F("",!0)])])]),_:1})}}}),Dt=he(vt,[["__scopeId","data-v-7512e877"]]);export{Dt as default};
