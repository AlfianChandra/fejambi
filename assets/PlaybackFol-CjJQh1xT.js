import{u as xe}from"./theme-D4xEnUbZ.js";import{_ as Te}from"./MainWrapperView.vue_vue_type_style_index_0_lang-BVGiSo-n.js";import{_ as X}from"./SelectView.vue_vue_type_style_index_0_lang-D4L401SS.js";import{_ as ne}from"./InputView.vue_vue_type_style_index_0_lang-BrNYmaX8.js";import{_ as h}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-CsKqe_IT.js";import{t as we}from"./trunk-CuaAdnZJ.js";import{a as Ve}from"./axios-BimPEqV4.js";import{d as ke,e as a,k as be,j as De,l as D,r as ve,o as p,c as y,g as t,a as o,w as c,q as g,m as Y,n as j,u as x,y as ae,D as oe,f as se,t as z,h as Le,F as ie,H as ze,_ as he,z as ge,p as Ae}from"./index-CpU8rLwU.js";import{i as Re}from"./index-CehbAW_K.js";import{h as F}from"./moment-C5S46NFB.js";const Ie={key:0,class:"datepickdialog"},Ue={class:"datepickinner"},Oe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ne={key:1,class:"selfnavdialog"},je={class:"selfnavdialog-inner"},Be={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Ee={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},qe={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Ge={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Ke={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},He={key:0,style:{"font-size":"11px"}},We={key:1,style:{"font-size":"11px"}},Je={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},Qe={style:{position:"relative"}},Xe={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Ze={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},et={style:{width:"100%",padding:"10px",position:"relative"}},tt=["max","value"],lt=ke({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange","onAutoRepChanged","onAutoplayChanged","onSelfNavChanged","onDirectionChanged"],setup(pe,{emit:ue}){const Z=we(),M=ue,m=xe(),u=pe,I=a(),r=a(),A=a(Z.getAllTrunk()),d=a(0),B=a(0),N=a([]),$=a(250);let k=null;const S=a(!1),_=a("forward");let R=null,E=[],U={};const re=a(),q=a(""),G=a(""),v=a(!0),n=a(!1),l=a(!1),i=a(!1),w=a(!1),K={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(f){return f.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]},de=a({grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(f){return f.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]}),W=()=>{r.value=Re(I.value),r.value.setOption(K),setTimeout(()=>{r.value.dispatchAction({type:"legendInverseSelect"}),r.value.dispatchAction({type:"legendAllSelect"})},100)};R=setInterval(()=>{r.value&&r.value&&r.value.resize()},1e3),be(()=>{clearInterval(R)}),De(()=>{window.addEventListener("keyup",ce),R||(R=setInterval(()=>{r.value&&r.value.resize()},1e3))}),be(()=>{R&&(clearInterval(R),R=null)}),D(()=>I.value,()=>{W(),H(d.value)}),D(()=>u.initPlaybackData,()=>{r.value&&r.value.setOption(de.value,{notMerge:!0}),H(d.value)});const H=f=>{E=[];for(let C of A.value[u.selectedSpot].spot)U[C.name]=[];u.initPlaybackData.slice(0,f+1).forEach((C,s)=>{const ye=`${C.dateFilter} (${C.timeRange})`;E.push(ye),re.value=ye,C.data.forEach(me=>{const $e=A.value[u.selectedSpot].spot.find(Pe=>Pe.id===me.idSpot).name,_e=me.avgPsiValues??0;U[$e][s]=Number(_e.toFixed(2))})});const b=Object.keys(U).map(C=>({name:C,type:"line",data:U[C],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(s){return s[0].value}},endLabel:{show:!0,formatter:function(s){return s.value+" ; "+C},color:"#000",fontSize:10,backgroundColor:"inherit",padding:5,borderRadius:5}}));r.value.setOption({xAxis:{data:E},series:b})},P=()=>{l.value=!1,d.value=0,N.value=[],clearInterval(k),H(d.value),B.value=d.value/u.initPlaybackData.length*100},Me=f=>{l.value=!1,N.value=[],d.value=parseInt(f.target.value,10),H(d.value),B.value=d.value/u.initPlaybackData.length*100};D(()=>u.initDateFilter,()=>{fe()});const fe=()=>{const f=F(u.initDateFilter),e=f.add(1,"days").format("YYYY-MM-DD"),b=f.subtract(2,"days").format("YYYY-MM-DD");q.value=e,G.value=b};fe();const ee=()=>{i.value=!0,P();const f=F(q.value).format("YYYY-MM-DD");n.value&&(l.value=!0),w.value=!0,M("onDateChange",f),setTimeout(()=>{i.value=!1},5e3)},te=()=>{i.value=!0,P();const f=F(G.value).format("YYYY-MM-DD");n.value&&(l.value=!0),w.value=!0,M("onDateChange",f),setTimeout(()=>{i.value=!1},5e3)};D(()=>v.value,()=>{v.value&&(Q(),S.value=!1,n.value=!1)}),D(()=>S.value,()=>{S.value?v.value=!1:v.value=!0}),D(()=>l.value,()=>{!l.value&&d.value==u.initPlaybackData.length&&(v.value?(P(),l.value=!0):S.value?_.value=="forward"?T.value?(console.log(u.initDateFilter,V.value),u.initDateFilter!=L.value?ee():le.value?(P(),M("onDateChange",V.value)):Q()):ee():T.value?u.initDateFilter!=V.value?te():le.value?(P(),M("onDateChange",L.value)):Q():te():(P(),l.value=!1))}),D(()=>[l.value,$.value],()=>{l.value?(k!=null&&clearInterval(k),k=setInterval(()=>{d.value<u.initPlaybackData.length?(d.value++,u.initPlaybackData[d.value]!=null&&(H(d.value),B.value=d.value/u.initPlaybackData.length*100)):(l.value=!1,clearInterval(k))},$.value)):k&&(clearInterval(k),k=null)}),D(()=>[m.asideVisible],()=>{setTimeout(()=>{r.value.resize()},1e3)});const J=a(!1),Se=()=>_.value=="forward"?q.value:G.value,O=a(!1),T=a(!1),le=a(!0),V=a(""),L=a(""),Ce=()=>{V.value?L.value?(T.value=!0,v.value=!1,S.value=!0,n.value=!0,O.value=!1,l.value=!1):m.notifyShowError("Date 2 is required"):m.notifyShowError("Date 1 is required")};D(()=>O.value,()=>{O.value?(l.value=!1,T.value=!1):l.value=!0}),D(()=>[T.value],()=>{T.value&&(P(),_.value=="forward"?M("onDateChange",V.value):M("onDateChange",L.value))}),D(()=>_.value,()=>{_.value=="backward"&&(P(),Q())});const Q=()=>{P(),console.log(u.initDateFilter),M("onDateChange",u.initDateFilter),T.value=!1,V.value=null,L.value=null},ce=f=>{(f.keyCode==80||f.keyCode==32)&&(l.value=!l.value),f.keyCode==37&&te(),f.keyCode==39&&ee()},Fe=()=>{r.value.setOption({})},Ye=()=>{r.value.setOption(K),H(d.value)};return(f,e)=>{const b=ve("font-awesome-icon"),C=ve("center");return p(),y(ie,null,[O.value?(p(),y("div",Ie,[t("div",Ue,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),o(X,{"in-label":"Speed","model-value":$.value,"onUpdate:modelValue":e[0]||(e[0]=s=>$.value=s)},{default:c(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),o(ne,{"in-type":"date","in-label":"Date 1","model-value":V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s)},null,8,["model-value"]),o(ne,{"in-type":"date","in-label":"Date 2","model-value":L.value,"onUpdate:modelValue":e[2]||(e[2]=s=>L.value=s)},null,8,["model-value"]),t("div",Oe,[o(h,{onClick:Ce,"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[16]||(e[16]=[g("Apply Filter")])),_:1}),o(h,{onClick:e[3]||(e[3]=s=>O.value=!O.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:c(()=>e[17]||(e[17]=[g("Cancel")])),_:1})])])])):Y("",!0),J.value?(p(),y("div",Ne,[t("div",je,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),o(X,{"in-label":"Direction","model-value":_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s)},{default:c(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),o(h,{onClick:e[5]||(e[5]=s=>J.value=!J.value),style:{width:"fit-content"},"bt-disabled":!1},{default:c(()=>[o(b,{icon:"save"}),e[21]||(e[21]=g(" Apply"))]),_:1})])])):Y("",!0),e[34]||(e[34]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),o(C,null,{default:c(()=>[o(X,{style:{width:"400px"},"in-label":"Speed","model-value":$.value,"onUpdate:modelValue":e[6]||(e[6]=s=>$.value=s)},{default:c(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Be,[t("div",Ee,[t("label",{class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>v.value=s),type:"checkbox"},null,512),[[oe,v.value]]),e[24]||(e[24]=g(" Auto-replay "))],2),t("label",{class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>n.value=s),type:"checkbox"},null,512),[[oe,n.value]]),e[25]||(e[25]=g(" Autoplay on navigating "))],2),t("label",{class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>S.value=s),type:"checkbox"},null,512),[[oe,S.value]]),e[26]||(e[26]=g(" Self Navigate "))],2),S.value?(p(),se(h,{key:0,onClick:e[10]||(e[10]=s=>J.value=!J.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(b,{icon:"sliders"})]),_:1})):Y("",!0)]),t("div",qe,[T.value?(p(),y("label",{key:0,class:j([`${x(m).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[g(z(x(F)(V.value).format("ddd, DD MMM YY"))+"    ",1),o(b,{icon:_.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),g("    "+z(x(F)(L.value).format("ddd, DD MMM YY")),1)],2)):Y("",!0),T.value?(p(),y("label",{key:1,class:j([`${x(m).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[ae(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>le.value=s),type:"checkbox"},null,512),[[oe,le.value]]),e[27]||(e[27]=g(" Repeat "))],2)):Y("",!0),o(h,{onClick:e[12]||(e[12]=s=>O.value=!O.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:c(()=>[o(b,{icon:"calendar"})]),_:1}),V.value&&L.value?(p(),se(h,{key:2,onClick:Q,"bt-disabled":!1,class:"slfnavbtn"},{default:c(()=>[o(b,{icon:"close"})]),_:1})):Y("",!0)])]),t("div",Ge,[o(h,{"bt-disabled":i.value,onClick:te},{default:c(()=>[o(b,{icon:"backward"}),g("    "+z(x(F)(G.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Ke,[t("b",{style:Le({color:`${x(m).accentColor}`})},z(x(F)(u.initDateFilter).format("ddd, DD MMM YY")),5),e[31]||(e[31]=t("br",null,null,-1)),T.value?(p(),y("span",{key:0,class:j([`${x(m).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=g("Stops at: ")),t("b",null,z(x(F)(L.value).format("ddd, DD MMM YY")),1)],2)):(p(),y(ie,{key:1},[v.value?(p(),y("span",He,[e[29]||(e[29]=g("Repeating: ")),t("b",null,z(x(F)(u.initDateFilter).format("ddd, DD MMM YY")),1)])):(p(),y("span",We,[e[30]||(e[30]=g("Upcoming: ")),t("b",null,z(x(F)(Se()).format("ddd, DD MMM YY")),1)]))],64))]),o(h,{"bt-disabled":i.value,onClick:ee},{default:c(()=>[g(z(x(F)(q.value).format("ddd, DD MMM YY"))+"    ",1),o(b,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Je,[o(h,{"bt-size":"small",onClick:Ye,"bt-disabled":!1},{default:c(()=>[o(b,{icon:"eye"}),e[32]||(e[32]=g(" Show All Legends"))]),_:1}),o(h,{"bt-size":"small",onClick:Fe,"bt-disabled":!1},{default:c(()=>[o(b,{icon:"eye-slash"}),e[33]||(e[33]=g(" Clear Legends"))]),_:1})]),t("div",{onKeydown:ze(ce,["enter"]),ref_key:"heatMap",ref:I,style:{width:"100%",height:"600px"}},null,544),t("div",Qe,[t("div",Xe,[t("div",Ze,[l.value?Y("",!0):(p(),y("button",{key:0,style:{position:"relative","z-index":"2"},onClick:e[13]||(e[13]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(b,{icon:"play"})])),l.value?(p(),y("button",{key:1,style:{position:"relative","z-index":"2"},onClick:e[14]||(e[14]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[o(b,{icon:"pause"})])):Y("",!0)]),t("div",et,[t("input",{style:{cursor:"pointer"},onChange:Me,type:"range",min:0,max:u.initPlaybackData.length,value:d.value,class:"slider"},null,40,tt)]),t("div",null,[!l.value&&d.value==u.initPlaybackData.length?(p(),y("button",{key:0,onClick:P,class:"controlbtn",type:"button"},[o(b,{icon:"undo"})])):Y("",!0)])])])],64)}}}),at=he(lt,[["__scopeId","data-v-afbf5d86"]]),ot={class:"row"},nt={class:"col-md-3"},st=["value"],it={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},ut={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},rt={class:"col-md-12",style:{position:"relative"}},dt={key:0,class:"loaders"},vt=ke({__name:"PlaybackFol",setup(pe){const ue=we(),Z=xe();Z.asideToggle(!1);const M=a(ue.getAllTrunk()),m=a("trunk1"),u=a();u.value=Object.keys(M.value);const I=a(5),r=a(),A=a([]),d=a(0),B=a([]),N=a(!1),$=a(!1),k=a(!1),S=a(!1),_=()=>{d.value++,A.value.push(null)};De(()=>{R(),setTimeout(()=>{$.value=!0},1e3)}),D(()=>[r.value,I.value,m.value],async()=>{S.value=!1,k.value=!0,await U()});const R=()=>{const v=new Date,n=v.getFullYear(),l=String(v.getMonth()+1).padStart(2,"0"),i=String(v.getDate()).padStart(2,"0"),w=`${n}-${l}-${i}`;r.value=w},E=async v=>new Promise(async(n,l)=>{try{const i=M.value[m.value];let w=[];for(let W=0;W<i.spot.length;W++)w.push(i.spot[W].id);const K={datefilter:v,timeFilter:I.value,idFilter:w},de=await Ve.post(Ae.baseEnd+"api/History/getsplittedhistdata",K);n(de.data)}catch(i){l(i)}}),U=async()=>{try{N.value=!0;let n=[...await E(r.value)];if(A.value.length>0){for(let l=0;l<A.value.length;l++){const i=A.value[l];if(i!==null){if(i.value!==r.value){const w=await E(i.value);n=n.concat(w)}}else console.log("Null")}k.value=!1}B.value=n,N.value=!1,S.value=!0}catch(v){console.log(v),k.value=!1,N.value=!1}},re=(v,n)=>{A.value[n]=v,U()},q=()=>{d.value>0&&(d.value--,A.value.pop()),U()},G=v=>{r.value=v};return(v,n)=>{const l=ve("font-awesome-icon");return p(),se(Te,{"context-title":"Data Playback"},{default:c(()=>[t("div",ot,[t("div",nt,[n[4]||(n[4]=t("h4",null,[t("b",null,"Filter")],-1)),o(X,{"in-label":"Select Line","model-value":m.value,"onUpdate:modelValue":n[0]||(n[0]=i=>m.value=i)},{default:c(()=>[(p(!0),y(ie,null,ge(u.value,(i,w)=>(p(),y("option",{key:w,value:i},z(M.value[i].name),9,st))),128))]),_:1},8,["model-value"]),o(X,{"in-label":"Time Range","model-value":I.value,"onUpdate:modelValue":n[1]||(n[1]=i=>I.value=i)},{default:c(()=>n[3]||(n[3]=[t("option",{value:"1"},"1 Minute",-1),t("option",{value:"2"},"2 Minutes",-1),t("option",{value:"3"},"3 Minutes",-1),t("option",{value:"4"},"4 Minutes",-1),t("option",{value:"5"},"5 Minutes",-1),t("option",{value:"10"},"10 Minutes",-1),t("option",{value:"15"},"15 Minutes",-1),t("option",{value:"30"},"30 Minutes",-1),t("option",{value:"60"},"60 Minutes",-1)])),_:1},8,["model-value"]),t("div",it,[o(ne,{"in-type":"date","in-label":"Date Filter","model-value":r.value,"onUpdate:modelValue":n[2]||(n[2]=i=>r.value=i),style:{width:"100%"}},null,8,["model-value"])]),t("div",ut,[o(h,{onClick:q,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(l,{icon:"minus"})]),_:1}),t("span",{class:j([`${x(Z).textTheme}`])},z(d.value),3),o(h,{onClick:_,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:c(()=>[o(l,{icon:"plus"})]),_:1})]),(p(!0),y(ie,null,ge(d.value,(i,w)=>(p(),y("div",{key:w,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[o(ne,{"in-type":"date","in-label":`Date Filter ${i}`,onOnValueChange:K=>re(K,w),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",rt,[N.value&&$.value?(p(),y("div",dt,n[5]||(n[5]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):Y("",!0),$.value?(p(),se(at,{key:1,"init-date-filter":r.value,"selected-spot":m.value,"init-playback-data":B.value,onOnDateChange:G},null,8,["init-date-filter","selected-spot","init-playback-data"])):Y("",!0)])])]),_:1})}}}),Dt=he(vt,[["__scopeId","data-v-7512e877"]]);export{Dt as default};
