import{u as me}from"./theme-42l5DWdZ.js";import{_ as Se}from"./MainWrapperView.vue_vue_type_style_index_0_lang-DOWrdKMd.js";import{_ as W}from"./SelectView.vue_vue_type_style_index_0_lang-DyyGwNu9.js";import{_ as ae}from"./InputView.vue_vue_type_style_index_0_lang-BfJYVU1R.js";import{_ as z}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-CdbxAsUj.js";import{t as ye}from"./trunk-CuaAdnZJ.js";import{a as Fe}from"./axios-BimPEqV4.js";import{d as be,e as l,k as $e,j as ge,l as h,r as ie,o as v,c as k,g as t,a as n,w as f,q as w,m as S,n as E,u as x,y as te,D as le,f as oe,t as U,h as Ye,H as _e,F as ue,_ as xe,z as ce,p as Pe}from"./index-D8U9RPFc.js";import{i as Ve}from"./index-CehbAW_K.js";import{h as R}from"./moment-C5S46NFB.js";const Te={key:0,class:"datepickdialog"},Re={class:"datepickinner"},ze={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ae={key:1,class:"selfnavdialog"},Ue={class:"selfnavdialog-inner"},Ie={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Le={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Ne={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Be={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Oe={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},je={key:1,style:{"font-size":"11px"}},Ee={style:{position:"relative"}},qe={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Ke={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},Ge={style:{width:"100%",padding:"10px",position:"relative"}},He=["max","value"],We=be({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0},isWaiting:{type:Boolean}},emits:["onDateChange","onAutoRepChanged","onAutoplayChanged","onSelfNavChanged","onDirectionChanged"],setup(re,{emit:ne}){const J=ye(),C=ne,c=me(),u=re,I=l(),m=l(),A=l(J.getAllTrunk()),r=l(0),O=l(0),j=l([]),F=l(250);let $=null;const Y=l(!1),L=l(!1),D=l("forward");let G=[];const q={},se=l();let y=null;const i=l(""),b=l(""),a=l(!0),d=l(!1),o=l(!1),N=l(!1),K=()=>{m.value=Ve(I.value);const p={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};m.value.setOption(p)};y=setInterval(()=>{m.value&&m.value&&m.value.resize()},1e3),$e(()=>{clearInterval(y)}),ge(()=>{window.addEventListener("keyup",ve)}),h(()=>I.value,()=>{K(),Q(r.value)}),h(()=>u.initPlaybackData,()=>{M(),K(),d.value&&(o.value=!0)});const Q=p=>{G=[];for(let T of A.value[u.selectedSpot].spot)q[T.name]=[];u.initPlaybackData.slice(0,p+1).forEach((T,s)=>{const pe=`${T.dateFilter} (${T.timeRange})`;G.push(pe),se.value=pe,T.data.forEach(fe=>{const he=A.value[u.selectedSpot].spot.find(Me=>Me.id===fe.idSpot).name,Ce=fe.avgPsiValues??0;q[he][s]=Number(Ce.toFixed(2))})});const g=Object.keys(q).map(T=>({name:T,type:"line",data:q[T],symbol:"none",smooth:!0,tooltip:{trigger:"axis",formatter:function(s){return s[0].value}},endLabel:{show:!0,formatter:function(s){return s.value},color:"#000",backgroundColor:"inherit",padding:5,borderRadius:5}}));m.value.setOption({xAxis:{data:G},series:g})},M=()=>{o.value=!1,r.value=0,j.value=[],clearInterval($),Q(r.value),O.value=r.value/u.initPlaybackData.length*100},ke=p=>{o.value=!1,j.value=[],r.value=parseInt(p.target.value,10),Q(r.value),O.value=r.value/u.initPlaybackData.length*100};h(()=>u.initDateFilter,()=>{de()});const de=()=>{const p=R(u.initDateFilter),e=p.add(1,"days").format("YYYY-MM-DD"),g=p.subtract(2,"days").format("YYYY-MM-DD");i.value=e,b.value=g};de();const X=()=>{N.value=!0,M();const p=R(i.value).format("YYYY-MM-DD");d.value&&(o.value=!0),C("onDateChange",p),setTimeout(()=>{N.value=!1},5e3)},Z=()=>{N.value=!0,M();const p=R(b.value).format("YYYY-MM-DD");d.value&&(o.value=!0),C("onDateChange",p),setTimeout(()=>{N.value=!1},5e3)};h(()=>a.value,()=>{a.value&&(H(),Y.value=!1,d.value=!1)}),h(()=>Y.value,()=>{Y.value?a.value=!1:a.value=!0}),h(()=>o.value,()=>{!o.value&&r.value==u.initPlaybackData.length&&(a.value?(M(),o.value=!0):(M(),o.value=!0,Y.value&&(D.value=="forward"?_.value?(console.log(u.initDateFilter,P.value),u.initDateFilter!=V.value?X():ee.value?(M(),C("onDateChange",P.value)):H()):X():_.value?u.initDateFilter!=P.value?Z():ee.value?(M(),C("onDateChange",V.value)):H():Z())))}),h(()=>[o.value,F.value],()=>{o.value?($!=null&&clearInterval($),$=setInterval(()=>{r.value<u.initPlaybackData.length?(r.value++,u.initPlaybackData[r.value]!=null&&(Q(r.value),O.value=r.value/u.initPlaybackData.length*100)):(o.value=!1,clearInterval($))},F.value)):$&&(clearInterval($),$=null)}),h(()=>[c.asideVisible],()=>{setTimeout(()=>{m.value.resize()},1e3)});const we=()=>D.value=="forward"?i.value:b.value,B=l(!1),_=l(!1),ee=l(!0),P=l(""),V=l(""),De=()=>{P.value?V.value?(_.value=!0,a.value=!1,Y.value=!0,d.value=!0,B.value=!1,o.value=!1):c.notifyShowError("Date 2 is required"):c.notifyShowError("Date 1 is required")};h(()=>B.value,()=>{B.value?(o.value=!1,_.value=!1):o.value=!0}),h(()=>[_.value],()=>{_.value&&(M(),D.value=="forward"?C("onDateChange",P.value):C("onDateChange",V.value))}),h(()=>D.value,()=>{D.value=="backward"&&(M(),H())});const H=()=>{M(),console.log(u.initDateFilter),C("onDateChange",u.initDateFilter),_.value=!1,P.value=null,V.value=null},ve=p=>{(p.keyCode==80||p.keyCode==32)&&(o.value=!o.value),p.keyCode==37&&Z(),p.keyCode==39&&X()};return(p,e)=>{const g=ie("font-awesome-icon"),T=ie("center");return v(),k(ue,null,[B.value?(v(),k("div",Te,[t("div",Re,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),n(W,{"in-label":"Speed","model-value":F.value,"onUpdate:modelValue":e[0]||(e[0]=s=>F.value=s)},{default:f(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),n(ae,{"in-type":"date","in-label":"Date 1","model-value":P.value,"onUpdate:modelValue":e[1]||(e[1]=s=>P.value=s)},null,8,["model-value"]),n(ae,{"in-type":"date","in-label":"Date 2","model-value":V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s)},null,8,["model-value"]),t("div",ze,[n(z,{onClick:De,"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[16]||(e[16]=[w("Apply Filter")])),_:1}),n(z,{onClick:e[3]||(e[3]=s=>B.value=!B.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:f(()=>e[17]||(e[17]=[w("Cancel")])),_:1})])])])):S("",!0),L.value?(v(),k("div",Ae,[t("div",Ue,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),n(W,{"in-label":"Direction","model-value":D.value,"onUpdate:modelValue":e[4]||(e[4]=s=>D.value=s)},{default:f(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),n(z,{onClick:e[5]||(e[5]=s=>L.value=!L.value),style:{width:"fit-content"},"bt-disabled":!1},{default:f(()=>[n(g,{icon:"save"}),e[21]||(e[21]=w(" Apply"))]),_:1})])])):S("",!0),e[31]||(e[31]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),n(T,null,{default:f(()=>[n(W,{style:{width:"400px"},"in-label":"Speed","model-value":F.value,"onUpdate:modelValue":e[6]||(e[6]=s=>F.value=s)},{default:f(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Ie,[t("div",Le,[t("label",{class:E([`${x(c).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.value=s),type:"checkbox"},null,512),[[le,a.value]]),e[24]||(e[24]=w(" Auto-replay "))],2),t("label",{class:E([`${x(c).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>d.value=s),type:"checkbox"},null,512),[[le,d.value]]),e[25]||(e[25]=w(" Autoplay on navigating "))],2),t("label",{class:E([`${x(c).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>Y.value=s),type:"checkbox"},null,512),[[le,Y.value]]),e[26]||(e[26]=w(" Self Navigate "))],2),Y.value?(v(),oe(z,{key:0,onClick:e[10]||(e[10]=s=>L.value=!L.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[n(g,{icon:"sliders"})]),_:1})):S("",!0)]),t("div",Ne,[_.value?(v(),k("label",{key:0,class:E([`${x(c).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[w(U(x(R)(P.value).format("ddd, DD MMM YY"))+"    ",1),n(g,{icon:D.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),w("    "+U(x(R)(V.value).format("ddd, DD MMM YY")),1)],2)):S("",!0),_.value?(v(),k("label",{key:1,class:E([`${x(c).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[te(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>ee.value=s),type:"checkbox"},null,512),[[le,ee.value]]),e[27]||(e[27]=w(" Repeat "))],2)):S("",!0),n(z,{onClick:e[12]||(e[12]=s=>B.value=!B.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:f(()=>[n(g,{icon:"calendar"})]),_:1}),P.value&&V.value?(v(),oe(z,{key:2,onClick:H,"bt-disabled":!1,class:"slfnavbtn"},{default:f(()=>[n(g,{icon:"close"})]),_:1})):S("",!0)])]),t("div",Be,[n(z,{"bt-disabled":N.value,onClick:Z},{default:f(()=>[n(g,{icon:"backward"}),w("    "+U(x(R)(b.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Oe,[t("b",{style:Ye({color:`${x(c).accentColor}`})},U(x(R)(u.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),_.value?(v(),k("span",{key:0,class:E([`${x(c).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=w("Stops at: ")),t("b",null,U(x(R)(V.value).format("ddd, DD MMM YY")),1)],2)):(v(),k("span",je,[e[29]||(e[29]=w("Upcoming: ")),t("b",null,U(x(R)(we()).format("ddd, DD MMM YY")),1)]))]),n(z,{"bt-disabled":N.value,onClick:X},{default:f(()=>[w(U(x(R)(i.value).format("ddd, DD MMM YY"))+"    ",1),n(g,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",{onKeydown:_e(ve,["enter"]),ref_key:"heatMap",ref:I,style:{width:"100%",height:"600px"}},null,544),t("div",Ee,[t("div",qe,[t("div",Ke,[o.value?S("",!0):(v(),k("button",{key:0,style:{position:"relative","z-index":"2"},onClick:e[13]||(e[13]=s=>o.value=!o.value),class:"controlbtn",type:"button"},[n(g,{icon:"play"})])),o.value?(v(),k("button",{key:1,style:{position:"relative","z-index":"2"},onClick:e[14]||(e[14]=s=>o.value=!o.value),class:"controlbtn",type:"button"},[n(g,{icon:"pause"})])):S("",!0)]),t("div",Ge,[t("input",{style:{cursor:"pointer"},onChange:ke,type:"range",min:0,max:u.initPlaybackData.length,value:r.value,class:"slider"},null,40,He)]),t("div",null,[!o.value&&r.value==u.initPlaybackData.length?(v(),k("button",{key:0,onClick:M,class:"controlbtn",type:"button"},[n(g,{icon:"undo"})])):S("",!0)])])])],64)}}}),Je=xe(We,[["__scopeId","data-v-9b75ffc0"]]),Qe={class:"row"},Xe={class:"col-md-3"},Ze=["value"],et={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},tt={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},lt={class:"col-md-12",style:{position:"relative"}},at={key:0,class:"loaders"},ot=be({__name:"PlaybackFol",setup(re){const ne=ye(),J=me();J.asideToggle(!1);const C=l(ne.getAllTrunk()),c=l("trunk1"),u=l();u.value=Object.keys(C.value);const I=l(5),m=l(),A=l([]),r=l(0),O=l([]),j=l(!1),F=l(!1),$=()=>{r.value++,A.value.push(null)};ge(()=>{Y(),setTimeout(()=>{F.value=!0},1e3)}),h(()=>[m.value,I.value,c.value],async()=>{await D()});const Y=()=>{const y=new Date,i=y.getFullYear(),b=String(y.getMonth()+1).padStart(2,"0"),a=String(y.getDate()).padStart(2,"0"),d=`${i}-${b}-${a}`;m.value=d},L=async y=>new Promise(async(i,b)=>{try{const a=C.value[c.value];let d=[];for(let K=0;K<a.spot.length;K++)d.push(a.spot[K].id);const o={datefilter:y,timeFilter:I.value,idFilter:d},N=await Fe.post(Pe.baseEnd+"api/History/getsplittedhistdata",o);i(N.data)}catch(a){b(a)}}),D=async()=>{O.value=[];try{j.value=!0;let i=[...await L(m.value)];if(A.value.length>0)for(let b=0;b<A.value.length;b++){const a=A.value[b];if(a!==null){if(a.value!==m.value){const d=await L(a.value);i=i.concat(d)}}else console.log("Null")}O.value=i,j.value=!1}catch(y){console.log(y),j.value=!1}},G=(y,i)=>{A.value[i]=y,D()},q=()=>{r.value>0&&(r.value--,A.value.pop()),D()},se=y=>{m.value=y};return(y,i)=>{const b=ie("font-awesome-icon");return v(),oe(Se,{"context-title":"Data Playback"},{default:f(()=>[t("div",Qe,[t("div",Xe,[i[4]||(i[4]=t("h4",null,[t("b",null,"Filter")],-1)),n(W,{"in-label":"Select Line","model-value":c.value,"onUpdate:modelValue":i[0]||(i[0]=a=>c.value=a)},{default:f(()=>[(v(!0),k(ue,null,ce(u.value,(a,d)=>(v(),k("option",{key:d,value:a},U(C.value[a].name),9,Ze))),128))]),_:1},8,["model-value"]),n(W,{"in-label":"Time Range","model-value":I.value,"onUpdate:modelValue":i[1]||(i[1]=a=>I.value=a)},{default:f(()=>i[3]||(i[3]=[t("option",{value:"1"},"1 Minute",-1),t("option",{value:"2"},"2 Minutes",-1),t("option",{value:"3"},"3 Minutes",-1),t("option",{value:"4"},"4 Minutes",-1),t("option",{value:"5"},"5 Minutes",-1),t("option",{value:"10"},"10 Minutes",-1),t("option",{value:"15"},"15 Minutes",-1),t("option",{value:"30"},"30 Minutes",-1),t("option",{value:"60"},"60 Minutes",-1)])),_:1},8,["model-value"]),t("div",et,[n(ae,{"in-type":"date","in-label":"Date Filter","model-value":m.value,"onUpdate:modelValue":i[2]||(i[2]=a=>m.value=a),style:{width:"100%"}},null,8,["model-value"])]),t("div",tt,[n(z,{onClick:q,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[n(b,{icon:"minus"})]),_:1}),t("span",{class:E([`${x(J).textTheme}`])},U(r.value),3),n(z,{onClick:$,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:f(()=>[n(b,{icon:"plus"})]),_:1})]),(v(!0),k(ue,null,ce(r.value,(a,d)=>(v(),k("div",{key:d,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[n(ae,{"in-type":"date","in-label":`Date Filter ${a}`,onOnValueChange:o=>G(o,d),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",lt,[j.value&&F.value?(v(),k("div",at,i[5]||(i[5]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):S("",!0),F.value?(v(),oe(Je,{key:1,"init-date-filter":m.value,"selected-spot":c.value,"init-playback-data":O.value,onOnDateChange:se},null,8,["init-date-filter","selected-spot","init-playback-data"])):S("",!0)])])]),_:1})}}}),mt=xe(ot,[["__scopeId","data-v-990d828e"]]);export{mt as default};
