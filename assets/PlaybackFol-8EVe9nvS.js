import{u as be}from"./theme-DGZgktrz.js";import{_ as _e}from"./MainWrapperView.vue_vue_type_style_index_0_lang-BR4oZGP8.js";import{_ as J}from"./SelectView.vue_vue_type_style_index_0_lang-dUEaSErK.js";import{_ as ne}from"./InputView.vue_vue_type_style_index_0_lang-DY1_zpTO.js";import{_ as h}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-D5SohY4b.js";import{t as ge}from"./trunk-CuaAdnZJ.js";import{a as Pe}from"./axios-BimPEqV4.js";import{d as ke,e as n,k as ye,j as xe,l as D,r as ue,o as p,c as x,g as t,a,w as v,q as g,m as F,n as B,u as k,y as le,D as ae,f as oe,t as R,h as Te,H as Ve,F as re,_ as we,z as me,p as Ae}from"./index-Ct5RpOR2.js";import{i as ze}from"./index-CehbAW_K.js";import{h as z}from"./moment-C5S46NFB.js";const Le={key:0,class:"datepickdialog"},Re={class:"datepickinner"},Ie={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Ue={key:1,class:"selfnavdialog"},Oe={class:"selfnavdialog-inner"},Ne={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},je={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Ee={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Be={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},qe={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Ke={key:1,style:{"font-size":"11px"}},Ge={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},He={style:{position:"relative"}},We={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center","margin-top":"-40px"}},Je={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},Qe={style:{width:"100%",padding:"10px",position:"relative"}},Xe=["max","value"],Ze=ke({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackData:{type:Array,required:!0}},emits:["onDateChange","onAutoRepChanged","onAutoplayChanged","onSelfNavChanged","onDirectionChanged"],setup(de,{emit:se}){const Q=ge(),C=se,b=be(),u=de,I=n(),i=n(),L=n(Q.getAllTrunk()),d=n(0),q=n(0),N=n([]),$=n(250);let w=null;const Y=n(!1),_=n("forward");let P=null,j=[],K={};const ie=n(),G=n(""),c=n(""),o=n(!0),f=n(!1),l=n(!1),y=n(!1),E=n(!1),X=()=>{i.value=ze(I.value);const r={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},xAxis:{type:"category",data:[],boundaryGap:!1,axisLabel:{formatter:function(e){return e.split(" (")[1].split(")")[0]},rotate:45,labelStyle:{fontSize:10}},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:600,interval:50,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};i.value.setOption(r),setTimeout(()=>{i.value.dispatchAction({type:"legendInverseSelect"}),i.value.dispatchAction({type:"legendAllSelect"})},100)};P=setInterval(()=>{i.value&&i.value&&i.value.resize()},1e3),ye(()=>{clearInterval(P)}),xe(()=>{window.addEventListener("keyup",pe),P||(P=setInterval(()=>{i.value&&i.value.resize()},1e3))}),ye(()=>{P&&(clearInterval(P),P=null)}),D(()=>I.value,()=>{X(),U(d.value)}),D(()=>u.initPlaybackData,()=>{M(),X(),E.value=!1,f.value&&(l.value=!0)});const U=r=>{j=[];for(let S of L.value[u.selectedSpot].spot)K[S.name]=[];u.initPlaybackData.slice(0,r+1).forEach((S,s)=>{const ce=`${S.dateFilter} (${S.timeRange})`;j.push(ce),ie.value=ce,S.data.forEach(fe=>{const Fe=L.value[u.selectedSpot].spot.find(Ye=>Ye.id===fe.idSpot).name,$e=fe.avgPsiValues??0;K[Fe][s]=Number($e.toFixed(2))})});const m=Object.keys(K).map(S=>({name:S,type:"line",data:K[S],symbol:"none",smooth:!1,tooltip:{trigger:"axis",formatter:function(s){return s[0].value}},endLabel:{show:!0,formatter:function(s){return s.value+" ; "+S},color:"#000",fontSize:10,backgroundColor:"inherit",padding:5,borderRadius:5}}));i.value.setOption({xAxis:{data:j},series:m})},M=()=>{l.value=!1,d.value=0,N.value=[],clearInterval(w),U(d.value),q.value=d.value/u.initPlaybackData.length*100},De=r=>{l.value=!1,N.value=[],d.value=parseInt(r.target.value,10),U(d.value),q.value=d.value/u.initPlaybackData.length*100};D(()=>u.initDateFilter,()=>{ve()});const ve=()=>{const r=z(u.initDateFilter),e=r.add(1,"days").format("YYYY-MM-DD"),m=r.subtract(2,"days").format("YYYY-MM-DD");G.value=e,c.value=m};ve();const Z=()=>{y.value=!0,M();const r=z(G.value).format("YYYY-MM-DD");f.value&&(l.value=!0),E.value=!0,C("onDateChange",r),setTimeout(()=>{y.value=!1},5e3)},ee=()=>{y.value=!0,M();const r=z(c.value).format("YYYY-MM-DD");f.value&&(l.value=!0),E.value=!0,C("onDateChange",r),setTimeout(()=>{y.value=!1},5e3)};D(()=>o.value,()=>{o.value&&(W(),Y.value=!1,f.value=!1)}),D(()=>Y.value,()=>{Y.value?o.value=!1:o.value=!0}),D(()=>l.value,()=>{!l.value&&d.value==u.initPlaybackData.length&&(o.value?(M(),l.value=!0):Y.value?_.value=="forward"?T.value?(console.log(u.initDateFilter,V.value),u.initDateFilter!=A.value?Z():te.value?(M(),C("onDateChange",V.value)):W()):Z():T.value?u.initDateFilter!=V.value?ee():te.value?(M(),C("onDateChange",A.value)):W():ee():(M(),l.value=!1))}),D(()=>[l.value,$.value],()=>{l.value?(w!=null&&clearInterval(w),w=setInterval(()=>{d.value<u.initPlaybackData.length?(d.value++,u.initPlaybackData[d.value]!=null&&(U(d.value),q.value=d.value/u.initPlaybackData.length*100)):(l.value=!1,clearInterval(w))},$.value)):w&&(clearInterval(w),w=null)}),D(()=>[b.asideVisible],()=>{setTimeout(()=>{i.value.resize()},1e3)});const H=n(!1),he=()=>_.value=="forward"?G.value:c.value,O=n(!1),T=n(!1),te=n(!0),V=n(""),A=n(""),Ce=()=>{V.value?A.value?(T.value=!0,o.value=!1,Y.value=!0,f.value=!0,O.value=!1,l.value=!1):b.notifyShowError("Date 2 is required"):b.notifyShowError("Date 1 is required")};D(()=>O.value,()=>{O.value?(l.value=!1,T.value=!1):l.value=!0}),D(()=>[T.value],()=>{T.value&&(M(),_.value=="forward"?C("onDateChange",V.value):C("onDateChange",A.value))}),D(()=>_.value,()=>{_.value=="backward"&&(M(),W())});const W=()=>{M(),console.log(u.initDateFilter),C("onDateChange",u.initDateFilter),T.value=!1,V.value=null,A.value=null},pe=r=>{(r.keyCode==80||r.keyCode==32)&&(l.value=!l.value),r.keyCode==37&&ee(),r.keyCode==39&&Z()},Me=()=>{const r=i.value.getOption().legend[0].selected;Object.keys(r).forEach(e=>{i.value.dispatchAction({type:"legendUnSelect",name:e})})},Se=()=>{const r=i.value.getOption().legend[0].selected;Object.keys(r).forEach(e=>{i.value.dispatchAction({type:"legendSelect",name:e})})};return(r,e)=>{const m=ue("font-awesome-icon"),S=ue("center");return p(),x(re,null,[O.value?(p(),x("div",Le,[t("div",Re,[e[18]||(e[18]=t("h2",null,[t("b",null,"Select Range")],-1)),e[19]||(e[19]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),a(J,{"in-label":"Speed","model-value":$.value,"onUpdate:modelValue":e[0]||(e[0]=s=>$.value=s)},{default:v(()=>e[15]||(e[15]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),a(ne,{"in-type":"date","in-label":"Date 1","model-value":V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s)},null,8,["model-value"]),a(ne,{"in-type":"date","in-label":"Date 2","model-value":A.value,"onUpdate:modelValue":e[2]||(e[2]=s=>A.value=s)},null,8,["model-value"]),t("div",Ie,[a(h,{onClick:Ce,"bt-disabled":!1,style:{width:"fit-content"}},{default:v(()=>e[16]||(e[16]=[g("Apply Filter")])),_:1}),a(h,{onClick:e[3]||(e[3]=s=>O.value=!O.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:v(()=>e[17]||(e[17]=[g("Cancel")])),_:1})])])])):F("",!0),H.value?(p(),x("div",Ue,[t("div",Oe,[e[22]||(e[22]=t("h2",null,[t("b",null,"Navigation Direction")],-1)),a(J,{"in-label":"Direction","model-value":_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s)},{default:v(()=>e[20]||(e[20]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),a(h,{onClick:e[5]||(e[5]=s=>H.value=!H.value),style:{width:"fit-content"},"bt-disabled":!1},{default:v(()=>[a(m,{icon:"save"}),e[21]||(e[21]=g(" Apply"))]),_:1})])])):F("",!0),e[33]||(e[33]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),a(S,null,{default:v(()=>[a(J,{style:{width:"400px"},"in-label":"Speed","model-value":$.value,"onUpdate:modelValue":e[6]||(e[6]=s=>$.value=s)},{default:v(()=>e[23]||(e[23]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Ne,[t("div",je,[t("label",{class:B([`${k(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>o.value=s),type:"checkbox"},null,512),[[ae,o.value]]),e[24]||(e[24]=g(" Auto-replay "))],2),t("label",{class:B([`${k(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>f.value=s),type:"checkbox"},null,512),[[ae,f.value]]),e[25]||(e[25]=g(" Autoplay on navigating "))],2),t("label",{class:B([`${k(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>Y.value=s),type:"checkbox"},null,512),[[ae,Y.value]]),e[26]||(e[26]=g(" Self Navigate "))],2),Y.value?(p(),oe(h,{key:0,onClick:e[10]||(e[10]=s=>H.value=!H.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:v(()=>[a(m,{icon:"sliders"})]),_:1})):F("",!0)]),t("div",Ee,[T.value?(p(),x("label",{key:0,class:B([`${k(b).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[g(R(k(z)(V.value).format("ddd, DD MMM YY"))+"    ",1),a(m,{icon:_.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),g("    "+R(k(z)(A.value).format("ddd, DD MMM YY")),1)],2)):F("",!0),T.value?(p(),x("label",{key:1,class:B([`${k(b).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[le(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>te.value=s),type:"checkbox"},null,512),[[ae,te.value]]),e[27]||(e[27]=g(" Repeat "))],2)):F("",!0),a(h,{onClick:e[12]||(e[12]=s=>O.value=!O.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:v(()=>[a(m,{icon:"calendar"})]),_:1}),V.value&&A.value?(p(),oe(h,{key:2,onClick:W,"bt-disabled":!1,class:"slfnavbtn"},{default:v(()=>[a(m,{icon:"close"})]),_:1})):F("",!0)])]),t("div",Be,[a(h,{"bt-disabled":y.value,onClick:ee},{default:v(()=>[a(m,{icon:"backward"}),g("    "+R(k(z)(c.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",qe,[t("b",{style:Te({color:`${k(b).accentColor}`})},R(k(z)(u.initDateFilter).format("ddd, DD MMM YY")),5),e[30]||(e[30]=t("br",null,null,-1)),T.value?(p(),x("span",{key:0,class:B([`${k(b).textTheme}`]),style:{"font-size":"11px"}},[e[28]||(e[28]=g("Stops at: ")),t("b",null,R(k(z)(A.value).format("ddd, DD MMM YY")),1)],2)):(p(),x("span",Ke,[e[29]||(e[29]=g("Upcoming: ")),t("b",null,R(k(z)(he()).format("ddd, DD MMM YY")),1)]))]),a(h,{"bt-disabled":y.value,onClick:Z},{default:v(()=>[g(R(k(z)(G.value).format("ddd, DD MMM YY"))+"    ",1),a(m,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",Ge,[a(h,{"bt-size":"small",onClick:Se,"bt-disabled":!1},{default:v(()=>[a(m,{icon:"eye"}),e[31]||(e[31]=g(" Show All Legends"))]),_:1}),a(h,{"bt-size":"small",onClick:Me,"bt-disabled":!1},{default:v(()=>[a(m,{icon:"eye-slash"}),e[32]||(e[32]=g(" Clear Legends"))]),_:1})]),t("div",{onKeydown:Ve(pe,["enter"]),ref_key:"heatMap",ref:I,style:{width:"100%",height:"600px"}},null,544),t("div",He,[t("div",We,[t("div",Je,[l.value?F("",!0):(p(),x("button",{key:0,style:{position:"relative","z-index":"2"},onClick:e[13]||(e[13]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[a(m,{icon:"play"})])),l.value?(p(),x("button",{key:1,style:{position:"relative","z-index":"2"},onClick:e[14]||(e[14]=s=>l.value=!l.value),class:"controlbtn",type:"button"},[a(m,{icon:"pause"})])):F("",!0)]),t("div",Qe,[t("input",{style:{cursor:"pointer"},onChange:De,type:"range",min:0,max:u.initPlaybackData.length,value:d.value,class:"slider"},null,40,Xe)]),t("div",null,[!l.value&&d.value==u.initPlaybackData.length?(p(),x("button",{key:0,onClick:M,class:"controlbtn",type:"button"},[a(m,{icon:"undo"})])):F("",!0)])])])],64)}}}),et=we(Ze,[["__scopeId","data-v-9d6be8b3"]]),tt={class:"row"},lt={class:"col-md-3"},at=["value"],nt={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},ot={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},st={class:"col-md-12",style:{position:"relative"}},it={key:0,class:"loaders"},ut=ke({__name:"PlaybackFol",setup(de){const se=ge(),Q=be();Q.asideToggle(!1);const C=n(se.getAllTrunk()),b=n("trunk1"),u=n();u.value=Object.keys(C.value);const I=n(5),i=n(),L=n([]),d=n(0),q=n([]),N=n(!1),$=n(!1),w=n(!1),Y=()=>{d.value++,L.value.push(null)};xe(()=>{_(),setTimeout(()=>{$.value=!0},1e3)}),D(()=>[i.value,I.value,b.value],async()=>{w.value=!0,await j()});const _=()=>{const c=new Date,o=c.getFullYear(),f=String(c.getMonth()+1).padStart(2,"0"),l=String(c.getDate()).padStart(2,"0"),y=`${o}-${f}-${l}`;i.value=y},P=async c=>new Promise(async(o,f)=>{try{const l=C.value[b.value];let y=[];for(let U=0;U<l.spot.length;U++)y.push(l.spot[U].id);const E={datefilter:c,timeFilter:I.value,idFilter:y},X=await Pe.post(Ae.baseEnd+"api/History/getsplittedhistdata",E);o(X.data)}catch(l){f(l)}}),j=async()=>{try{N.value=!0;let o=[...await P(i.value)];if(L.value.length>0){for(let f=0;f<L.value.length;f++){const l=L.value[f];if(l!==null){if(l.value!==i.value){const y=await P(l.value);o=o.concat(y)}}else console.log("Null")}w.value=!1}q.value=o,N.value=!1}catch(c){console.log(c),w.value=!1,N.value=!1}},K=(c,o)=>{L.value[o]=c,j()},ie=()=>{d.value>0&&(d.value--,L.value.pop()),j()},G=c=>{i.value=c};return(c,o)=>{const f=ue("font-awesome-icon");return p(),oe(_e,{"context-title":"Data Playback"},{default:v(()=>[t("div",tt,[t("div",lt,[o[4]||(o[4]=t("h4",null,[t("b",null,"Filter")],-1)),a(J,{"in-label":"Select Line","model-value":b.value,"onUpdate:modelValue":o[0]||(o[0]=l=>b.value=l)},{default:v(()=>[(p(!0),x(re,null,me(u.value,(l,y)=>(p(),x("option",{key:y,value:l},R(C.value[l].name),9,at))),128))]),_:1},8,["model-value"]),a(J,{"in-label":"Time Range","model-value":I.value,"onUpdate:modelValue":o[1]||(o[1]=l=>I.value=l)},{default:v(()=>o[3]||(o[3]=[t("option",{value:"1"},"1 Minute",-1),t("option",{value:"2"},"2 Minutes",-1),t("option",{value:"3"},"3 Minutes",-1),t("option",{value:"4"},"4 Minutes",-1),t("option",{value:"5"},"5 Minutes",-1),t("option",{value:"10"},"10 Minutes",-1),t("option",{value:"15"},"15 Minutes",-1),t("option",{value:"30"},"30 Minutes",-1),t("option",{value:"60"},"60 Minutes",-1)])),_:1},8,["model-value"]),t("div",nt,[a(ne,{"in-type":"date","in-label":"Date Filter","model-value":i.value,"onUpdate:modelValue":o[2]||(o[2]=l=>i.value=l),style:{width:"100%"}},null,8,["model-value"])]),t("div",ot,[a(h,{onClick:ie,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:v(()=>[a(f,{icon:"minus"})]),_:1}),t("span",{class:B([`${k(Q).textTheme}`])},R(d.value),3),a(h,{onClick:Y,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:v(()=>[a(f,{icon:"plus"})]),_:1})]),(p(!0),x(re,null,me(d.value,(l,y)=>(p(),x("div",{key:y,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[a(ne,{"in-type":"date","in-label":`Date Filter ${l}`,onOnValueChange:E=>K(E,y),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128))]),t("div",st,[N.value&&$.value?(p(),x("div",it,o[5]||(o[5]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):F("",!0),$.value?(p(),oe(et,{key:1,"init-date-filter":i.value,"selected-spot":b.value,"init-playback-data":q.value,onOnDateChange:G},null,8,["init-date-filter","selected-spot","init-playback-data"])):F("",!0)])])]),_:1})}}}),kt=we(ut,[["__scopeId","data-v-8729811b"]]);export{kt as default};
